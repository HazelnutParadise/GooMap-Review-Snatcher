import{S as Z,i as x,s as ee,d as v,t as U,b as E,r as K,e as te,h as P,u as S,K as se,v as R,H as Q,L as re,z as M,w as D,x as N,y as W,C as G,A as L,B as X,q as ne,o as oe,a as z,m as J,j as V,f as $,J as C,M as q,N as A,g as ae}from"../chunks/index-BcAQgaGx.js";import le from"./InputCard-DEM7y--e.js";import ce from"./Loader-CT3sUNCL.js";import ie from"./Result-NhYqm1D_.js";import"../chunks/each-D6YF6ztN.js";import"./InfoCard-l3ckkPzU.js";const ue=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{document:H}=ue;function fe(o){let t,s;return t=new ie({props:{selectedStore:o[3],searchInputStr:o[2],storeData:o[5],reviews:o[6],download:o[10]}}),{c(){$(t.$$.fragment)},l(e){V(t.$$.fragment,e)},m(e,a){J(t,e,a),s=!0},p(e,a){const c={};a&8&&(c.selectedStore=e[3]),a&4&&(c.searchInputStr=e[2]),a&32&&(c.storeData=e[5]),a&64&&(c.reviews=e[6]),t.$set(c)},i(e){s||(E(t.$$.fragment,e),s=!0)},o(e){U(t.$$.fragment,e),s=!1},d(e){z(t,e)}}}function pe(o){let t,s,e,a,c;function p(r){o[11](r)}function u(r){o[12](r)}function g(r){o[13](r)}let i={handleSearch:o[8],handleGetReview:o[9],storeData:o[5]};return o[4]!==void 0&&(i.pagesToFetch=o[4]),o[2]!==void 0&&(i.searchInputStr=o[2]),o[3]!==void 0&&(i.selectedStore=o[3]),t=new le({props:i}),C.push(()=>q(t,"pagesToFetch",p)),C.push(()=>q(t,"searchInputStr",u)),C.push(()=>q(t,"selectedStore",g)),{c(){$(t.$$.fragment)},l(r){V(t.$$.fragment,r)},m(r,f){J(t,r,f),c=!0},p(r,f){const b={};f&32&&(b.storeData=r[5]),!s&&f&16&&(s=!0,b.pagesToFetch=r[4],A(()=>s=!1)),!e&&f&4&&(e=!0,b.searchInputStr=r[2],A(()=>e=!1)),!a&&f&8&&(a=!0,b.selectedStore=r[3],A(()=>a=!1)),t.$set(b)},i(r){c||(E(t.$$.fragment,r),c=!0)},o(r){U(t.$$.fragment,r),c=!1},d(r){z(t,r)}}}function de(o){let t,s;return t=new ce({}),{c(){$(t.$$.fragment)},l(e){V(t.$$.fragment,e)},m(e,a){J(t,e,a),s=!0},p:oe,i(e){s||(E(t.$$.fragment,e),s=!0)},o(e){U(t.$$.fragment,e),s=!1},d(e){z(t,e)}}}function he(o){let t,s,e,a,c,p,u,g,i,r,f,b,T,j,d,h,n;H.title=t=o[0]+" - 榛果繽紛樂";const k=[de,pe,fe],_=[];function O(l,m){return m&64&&(j=null),l[7]?0:(j==null&&(j=Object.keys(l[6]).length==0),j?1:2)}return d=O(o,-1),h=_[d]=k[d](o),{c(){s=G(),e=L("div"),a=L("img"),p=G(),u=L("div"),g=L("h1"),i=X(o[0]),r=G(),f=L("h2"),b=X(o[1]),T=G(),h.c(),this.h()},l(l){re("svelte-1kuv545",H.head).forEach(v),s=M(l),e=D(l,"DIV",{class:!0});var w=N(e);a=D(w,"IMG",{src:!0,alt:!0,style:!0}),p=M(w),u=D(w,"DIV",{class:!0});var y=N(u);g=D(y,"H1",{class:!0});var F=N(g);i=W(F,o[0]),F.forEach(v),r=M(y),f=D(y,"H2",{class:!0});var B=N(f);b=W(B,o[1]),B.forEach(v),y.forEach(v),T=M(w),h.l(w),w.forEach(v),this.h()},h(){se(a.src,c="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png")||R(a,"src",c),R(a,"alt","GooMapReviewSnatcher"),Q(a,"width","100%"),Q(a,"max-width","150px"),R(g,"class","title svelte-fc3bky"),R(f,"class","subtitle svelte-fc3bky"),R(u,"class","title-box svelte-fc3bky"),R(e,"class","container svelte-fc3bky")},m(l,m){P(l,s,m),P(l,e,m),S(e,a),S(e,p),S(e,u),S(u,g),S(g,i),S(u,r),S(u,f),S(f,b),S(e,T),_[d].m(e,null),n=!0},p(l,[m]){(!n||m&1)&&t!==(t=l[0]+" - 榛果繽紛樂")&&(H.title=t),(!n||m&1)&&K(i,l[0]),(!n||m&2)&&K(b,l[1]);let w=d;d=O(l,m),d===w?_[d].p(l,m):(ae(),U(_[w],1,1,()=>{_[w]=null}),te(),h=_[d],h?h.p(l,m):(h=_[d]=k[d](l),h.c()),E(h,1),h.m(e,null))},i(l){n||(E(h),n=!0)},o(l){U(h),n=!1},d(l){l&&(v(s),v(e)),_[d].d()}}}const _e="/api/search",me="/api/reviews";function ge(o,t,s){let{title:e}=t,{subtitle:a}=t,c="",p="",u=1,g=[],i=[],r=!1;const f=async()=>{if(s(7,r=!0),console.log(c),c===""){alert("請輸入搜尋關鍵字"),s(7,r=!1);return}try{const n=await fetch(_e+`?storeName=${c}`);if(!n.ok){console.error("Error:",n.statusText),alert("無法取得搜尋結果");return}s(5,g=await n.json()),console.log(g)}catch(n){console.error(n),alert("無法取得搜尋結果")}finally{s(7,r=!1)}},b=async()=>{if(s(7,r=!0),console.log(p),p===""){alert("請選擇店家"),s(7,r=!1);return}try{const n=await fetch(me+`?storeID=${p.ID}&pages=${u}`);if(!n.ok){console.error("Error:",n.statusText),alert("無法取得評論");return}s(6,i=await n.json()),console.log(i)}catch(n){console.error(n),alert("無法取得評論")}finally{s(7,r=!1)}},T=n=>{const k=document.createElement("a");let _="";switch(n){case"csv":const O=new Uint8Array([239,187,191]),l=Object.keys(i[0]).join(","),m=i.map(Y=>Object.values(Y).map(I=>typeof I=="string"&&(I.includes(",")||I.includes(`
`)||I.includes('"'))?`"${I.replace(/"/g,'""')}"`:I).join(",")),w=l+`
`+m.join(`
`),y=new Blob([O,w],{type:"text/csv;charset=utf-8"});_=window.URL.createObjectURL(y),k.href=_,k.download=`${p.Name}.csv`,k.click();break;case"json":const F=JSON.stringify(i,null,2),B=new Blob([F],{type:"application/json;charset=utf-8"});_=window.URL.createObjectURL(B),k.href=_,k.download=`${p.Name}.json`,k.click();break}window.URL.revokeObjectURL(_)};ne(async()=>{getNavbar()});function j(n){u=n,s(4,u)}function d(n){c=n,s(2,c)}function h(n){p=n,s(3,p)}return o.$$set=n=>{"title"in n&&s(0,e=n.title),"subtitle"in n&&s(1,a=n.subtitle)},[e,a,c,p,u,g,i,r,f,b,T,j,d,h]}class ye extends Z{constructor(t){super(),x(this,t,ge,he,ee,{title:0,subtitle:1})}}export{ye as default};
