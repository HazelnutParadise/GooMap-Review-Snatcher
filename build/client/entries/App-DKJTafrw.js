import{l as ut,b as wt,H as ft,e as bt,t as x,j as o,f as I,h as m,d as f,g as pt,k as s,m as t,o as b,$ as mt,c as gt,q as a}from"../chunks/template-Ck2fRipi.js";import{s as g}from"../chunks/render-B3o7HRdp.js";import{a as xt,i as P}from"../chunks/lifecycle-BJN0pLMS.js";import{I as yt,e as N,a as T,i as A}from"../chunks/InputCard-BkRnv2Wa.js";import{p as V}from"../chunks/props-8vpwuoM1.js";import{o as _t}from"../chunks/index-client-07cMjNGe.js";import jt from"./Loader-CFgeOWCn.js";import kt from"./Ad-DkWk2OLu.js";import"./InfoCard-DsmM0Zsi.js";function St(k){var u;u=document.head.appendChild(ut());try{wt(()=>k(u),ft)}finally{}}var Ot=x('<th class="svelte-12wvi4t"> </th>'),Rt=x('<td class="svelte-12wvi4t"> </td>'),Ut=x('<tr class="svelte-12wvi4t"></tr>'),Bt=x('<button class="reset-button button svelte-12wvi4t">查詢其他商家</button> <div class="review-box svelte-12wvi4t"><h3 class="store-name svelte-12wvi4t"> </h3> <button class="download-button button svelte-12wvi4t">下載 CSV</button> <button class="download-button button svelte-12wvi4t">下載 JSON</button> <div class="review-table-box svelte-12wvi4t"><table class="review-table svelte-12wvi4t"><thead class="svelte-12wvi4t"><tr class="svelte-12wvi4t"></tr></thead><tbody class="svelte-12wvi4t"></tbody></table></div></div>',1),Lt=x('<div id="navbar-placeholder" style="height: 50px; z-index: 100;" class="svelte-12wvi4t"></div> <div id="Pistachio-Announcement" style="display: fixed; top: 20px; left: 0; z-index: 100;" class="svelte-12wvi4t"></div> <div class="container svelte-12wvi4t"><img src="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png" alt="GooMapReviewSnatcher" style="width: 100%; max-width: 150px;" class="svelte-12wvi4t"> <div class="title-box svelte-12wvi4t"><h1 class="title svelte-12wvi4t"> </h1> <h2 class="subtitle svelte-12wvi4t"> </h2></div> <!></div> <footer class="svelte-12wvi4t"><!> 2025 - 榛果繽紛樂</footer>',1);function Mt(k,u){bt(u,!1);let C=V(u,"title",8),K=V(u,"subtitle",8);const Q="/api/search",W="/api/reviews";let w=b(""),c=b(""),S=b(1),y=b([]),l=b([]),d=b(!1);const X=async()=>{if(a(d,!0),console.log(t(w)),t(w)===""){alert("請輸入搜尋關鍵字"),a(d,!1);return}try{const e=await fetch(Q+`?storeName=${t(w)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得搜尋結果");return}a(y,await e.json()),console.log(t(y))}catch(e){console.error(e),alert("無法取得搜尋結果")}finally{a(d,!1)}},Y=async()=>{if(a(d,!0),console.log(t(c)),t(c)===""){alert("請選擇店家"),a(d,!1);return}try{const e=await fetch(W+`?storeID=${t(c).ID}&pages=${t(S)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得評論");return}a(l,await e.json()),console.log(t(l))}catch(e){console.error(e),alert("無法取得評論")}finally{a(d,!1)}},D=e=>{const n=document.createElement("a");let h="";switch(e){case"csv":const O=new Uint8Array([239,187,191]),R=Object.keys(t(l)[0]).join(","),v=t(l).map(B=>Object.values(B).map(i=>typeof i=="string"&&(i.includes(",")||i.includes(`
`)||i.includes('"'))?`"${i.replace(/"/g,'""')}"`:i).join(",")),r=R+`
`+v.join(`
`),_=new Blob([O,r],{type:"text/csv;charset=utf-8"});h=window.URL.createObjectURL(_),n.href=h,n.download=`${t(c).Name}.csv`,n.click();break;case"json":const U=JSON.stringify(t(l),null,2),j=new Blob([U],{type:"application/json;charset=utf-8"});h=window.URL.createObjectURL(j),n.href=h,n.download=`${t(c).Name}.json`,n.click();break}window.URL.revokeObjectURL(h)};_t(async()=>{getNavbar()}),xt();var $=Lt();St(e=>{m(()=>mt.title=`${C()??""} - 榛果繽紛樂`)});var M=o(I($),4),z=o(s(M),2),G=s(z),Z=s(G),tt=o(G,2),et=s(tt),at=o(z,2);{var st=e=>{jt(e)},rt=e=>{var n=gt(),h=I(n);{var O=v=>{yt(v,{handleSearch:X,handleGetReview:Y,get storeData(){return t(y)},get pagesToFetch(){return t(S)},set pagesToFetch(r){a(S,r)},get searchInputStr(){return t(w)},set searchInputStr(r){a(w,r)},get selectedStore(){return t(c)},set selectedStore(r){a(c,r)},$$legacy:!0})},R=v=>{var r=Bt(),_=I(r),U=o(_,2),j=s(U),B=s(j),i=o(j,2),H=o(i,2),nt=o(H,2),it=s(nt),J=s(it),ct=s(J);N(ct,5,()=>Object.keys(t(l)[0]),A,(L,E)=>{var p=Ot(),F=s(p);m(()=>g(F,t(E))),f(L,p)});var vt=o(J);N(vt,5,()=>t(l),A,(L,E)=>{var p=Ut();N(p,5,()=>Object.values(t(E)),A,(F,dt)=>{var q=Rt(),ht=s(q);m(()=>g(ht,t(dt))),f(F,q)}),f(L,p)}),m(()=>g(B,t(c).Name)),T("click",_,()=>{a(w,""),a(y,[]),a(l,[])}),T("click",i,()=>D("csv")),T("click",H,()=>D("json")),f(v,r)};P(h,v=>{Object.keys(t(l)).length==0?v(O):v(R,!1)},!0)}f(e,n)};P(at,e=>{t(d)?e(st):e(rt,!1)})}var ot=o(M,2),lt=s(ot);kt(lt),m(()=>{g(Z,C()),g(et,K())}),f(k,$),pt()}export{Mt as default};
