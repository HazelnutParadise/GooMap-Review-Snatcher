import{l as ut,b as dt,H as ht,e as wt,t as _,j as c,f as U,h as m,d as b,g as bt,k as s,m as t,o as f,$ as ft,c as pt,q as a}from"../chunks/template-Ck2fRipi.js";import{s as g}from"../chunks/render-B3o7HRdp.js";import{a as mt,i as z}from"../chunks/lifecycle-BJN0pLMS.js";import{I as gt,e as L,a as E,i as I}from"../chunks/InputCard-Rb-4G0ng.js";import{p as V}from"../chunks/props-8vpwuoM1.js";import{o as _t}from"../chunks/index-client-07cMjNGe.js";import yt from"./Loader-CFgeOWCn.js";import"./InfoCard-Enpj5mUS.js";function Ct(D){var h;h=document.head.appendChild(ut());try{dt(()=>D(h),ht)}finally{}}var jt=_('<th class="svelte-12wvi4t"> </th>'),Dt=_('<td class="svelte-12wvi4t"> </td>'),xt=_('<tr class="svelte-12wvi4t"></tr>'),kt=_('<button class="reset-button button svelte-12wvi4t">查詢其他商家</button> <div class="review-box svelte-12wvi4t"><h3 class="store-name svelte-12wvi4t"> </h3> <button class="download-button button svelte-12wvi4t">下載 CSV</button> <button class="download-button button svelte-12wvi4t">下載 JSON</button> <div class="review-table-box svelte-12wvi4t"><table class="review-table svelte-12wvi4t"><thead class="svelte-12wvi4t"><tr class="svelte-12wvi4t"></tr></thead><tbody class="svelte-12wvi4t"></tbody></table></div></div>',1),Bt=_('<div id="navbar-placeholder" class="svelte-12wvi4t"></div> <div class="container svelte-12wvi4t"><img src="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png" alt="GooMapReviewSnatcher" style="width: 100%; max-width: 150px;" class="svelte-12wvi4t"> <div class="title-box svelte-12wvi4t"><h1 class="title svelte-12wvi4t"> </h1> <h2 class="subtitle svelte-12wvi4t"> </h2></div> <!></div> <footer class="svelte-12wvi4t">2025 - 榛果繽紛樂</footer>',1);function It(D,h){wt(h,!1);let N=V(h,"title",8),K=V(h,"subtitle",8);const P="/api/search",Q="/api/reviews";let w=f(""),i=f(""),x=f(1),y=f([]),o=f([]),u=f(!1);const W=async()=>{if(a(u,!0),console.log(t(w)),t(w)===""){alert("請輸入搜尋關鍵字"),a(u,!1);return}try{const e=await fetch(P+`?storeName=${t(w)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得搜尋結果");return}a(y,await e.json()),console.log(t(y))}catch(e){console.error(e),alert("無法取得搜尋結果")}finally{a(u,!1)}},X=async()=>{if(a(u,!0),console.log(t(i)),t(i)===""){alert("請選擇店家"),a(u,!1);return}try{const e=await fetch(Q+`?storeID=${t(i).ID}&pages=${t(x)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得評論");return}a(o,await e.json()),console.log(t(o))}catch(e){console.error(e),alert("無法取得評論")}finally{a(u,!1)}},T=e=>{const l=document.createElement("a");let d="";switch(e){case"csv":const k=new Uint8Array([239,187,191]),B=Object.keys(t(o)[0]).join(","),v=t(o).map(O=>Object.values(O).map(n=>typeof n=="string"&&(n.includes(",")||n.includes(`
`)||n.includes('"'))?`"${n.replace(/"/g,'""')}"`:n).join(",")),r=B+`
`+v.join(`
`),C=new Blob([k,r],{type:"text/csv;charset=utf-8"});d=window.URL.createObjectURL(C),l.href=d,l.download=`${t(i).Name}.csv`,l.click();break;case"json":const S=JSON.stringify(t(o),null,2),j=new Blob([S],{type:"application/json;charset=utf-8"});d=window.URL.createObjectURL(j),l.href=d,l.download=`${t(i).Name}.json`,l.click();break}window.URL.revokeObjectURL(d)};_t(async()=>{getNavbar()}),mt();var $=Bt();Ct(e=>{m(()=>ft.title=`${N()??""} - 榛果繽紛樂`)});var Y=c(U($),2),M=c(s(Y),2),G=s(M),Z=s(G),tt=c(G,2),et=s(tt),at=c(M,2);{var st=e=>{yt(e)},rt=e=>{var l=pt(),d=U(l);{var k=v=>{gt(v,{handleSearch:W,handleGetReview:X,get storeData(){return t(y)},get pagesToFetch(){return t(x)},set pagesToFetch(r){a(x,r)},get searchInputStr(){return t(w)},set searchInputStr(r){a(w,r)},get selectedStore(){return t(i)},set selectedStore(r){a(i,r)},$$legacy:!0})},B=v=>{var r=kt(),C=U(r),S=c(C,2),j=s(S),O=s(j),n=c(j,2),H=c(n,2),ot=c(H,2),lt=s(ot),J=s(lt),nt=s(J);L(nt,5,()=>Object.keys(t(o)[0]),I,(F,R)=>{var p=jt(),A=s(p);m(()=>g(A,t(R))),b(F,p)});var ct=c(J);L(ct,5,()=>t(o),I,(F,R)=>{var p=xt();L(p,5,()=>Object.values(t(R)),I,(A,it)=>{var q=Dt(),vt=s(q);m(()=>g(vt,t(it))),b(A,q)}),b(F,p)}),m(()=>g(O,t(i).Name)),E("click",C,()=>{a(w,""),a(y,[]),a(o,[])}),E("click",n,()=>T("csv")),E("click",H,()=>T("json")),b(v,r)};z(d,v=>{Object.keys(t(o)).length==0?v(k):v(B,!1)},!0)}b(e,l)};z(at,e=>{t(u)?e(st):e(rt,!1)})}m(()=>{g(Z,N()),g(et,K())}),b(D,$),bt()}export{It as default};
