import{S as ve,i as we,s as ke,d as b,t as X,b as Z,r as x,e as Te,h as z,u as d,K as Se,v as C,H as ce,L as je,z as B,w as y,x as U,y as P,C as L,A as E,B as K,q as ye,o as le,a as me,m as pe,j as be,f as ge,J as $,M as ee,N as te,O as ne,P as Ee,Q as Y,I as W,g as Ce}from"../chunks/index-CtmGPglQ.js";import{I as Oe,e as q}from"../chunks/InputCard-BQDcxm56.js";import Ie from"./Loader-Cd-iapTC.js";import"./InfoCard-VSrB1MFF.js";const Ue=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{document:se}=Ue;function ie(a,e,l){const s=a.slice();return s[18]=e[l],s}function he(a,e,l){const s=a.slice();return s[21]=e[l],s}function ue(a,e,l){const s=a.slice();return s[24]=e[l],s}function Ne(a){let e,l="查詢其他商家",s,t,n,u=a[3].Name+"",c,w,f,h="下載 CSV",k,v,F="下載 JSON",H,p,O="使用 StoreCoach 探勘",N,D,T,M,o,m,_,I,A,R=q(Object.keys(a[6][0])),S=[];for(let i=0;i<R.length;i+=1)S[i]=fe(ue(a,R,i));let G=q(a[6]),j=[];for(let i=0;i<G.length;i+=1)j[i]=de(ie(a,G,i));return{c(){e=E("button"),e.textContent=l,s=L(),t=E("div"),n=E("h3"),c=K(u),w=L(),f=E("button"),f.textContent=h,k=L(),v=E("button"),v.textContent=F,H=L(),p=E("button"),p.textContent=O,N=L(),D=E("div"),T=E("table"),M=E("thead"),o=E("tr");for(let i=0;i<S.length;i+=1)S[i].c();m=L(),_=E("tbody");for(let i=0;i<j.length;i+=1)j[i].c();this.h()},l(i){e=y(i,"BUTTON",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1g2am1l"&&(e.textContent=l),s=B(i),t=y(i,"DIV",{class:!0});var g=U(t);n=y(g,"H3",{class:!0});var r=U(n);c=P(r,u),r.forEach(b),w=B(g),f=y(g,"BUTTON",{class:!0,"data-svelte-h":!0}),W(f)!=="svelte-15xnx41"&&(f.textContent=h),k=B(g),v=y(g,"BUTTON",{class:!0,"data-svelte-h":!0}),W(v)!=="svelte-13ra2p9"&&(v.textContent=F),H=B(g),p=y(g,"BUTTON",{class:!0,"data-svelte-h":!0}),W(p)!=="svelte-1uktzfy"&&(p.textContent=O),N=B(g),D=y(g,"DIV",{class:!0});var V=U(D);T=y(V,"TABLE",{class:!0});var Q=U(T);M=y(Q,"THEAD",{});var oe=U(M);o=y(oe,"TR",{class:!0});var ae=U(o);for(let J=0;J<S.length;J+=1)S[J].l(ae);ae.forEach(b),oe.forEach(b),m=B(Q),_=y(Q,"TBODY",{});var re=U(_);for(let J=0;J<j.length;J+=1)j[J].l(re);re.forEach(b),Q.forEach(b),V.forEach(b),g.forEach(b),this.h()},h(){C(e,"class","reset-button button svelte-19sm30h"),C(n,"class","store-name svelte-19sm30h"),C(f,"class","download-button button svelte-19sm30h"),C(v,"class","download-button button svelte-19sm30h"),C(p,"class","mining-button button svelte-19sm30h"),C(o,"class","svelte-19sm30h"),C(T,"class","review-table svelte-19sm30h"),C(D,"class","review-table-box svelte-19sm30h"),C(t,"class","review-box svelte-19sm30h")},m(i,g){z(i,e,g),z(i,s,g),z(i,t,g),d(t,n),d(n,c),d(t,w),d(t,f),d(t,k),d(t,v),d(t,H),d(t,p),d(t,N),d(t,D),d(D,T),d(T,M),d(M,o);for(let r=0;r<S.length;r+=1)S[r]&&S[r].m(o,null);d(T,m),d(T,_);for(let r=0;r<j.length;r+=1)j[r]&&j[r].m(_,null);I||(A=[Y(e,"click",a[14]),Y(f,"click",a[15]),Y(v,"click",a[16]),Y(p,"click",a[17])],I=!0)},p(i,g){if(g&8&&u!==(u=i[3].Name+"")&&x(c,u),g&64){R=q(Object.keys(i[6][0]));let r;for(r=0;r<R.length;r+=1){const V=ue(i,R,r);S[r]?S[r].p(V,g):(S[r]=fe(V),S[r].c(),S[r].m(o,null))}for(;r<S.length;r+=1)S[r].d(1);S.length=R.length}if(g&64){G=q(i[6]);let r;for(r=0;r<G.length;r+=1){const V=ie(i,G,r);j[r]?j[r].p(V,g):(j[r]=de(V),j[r].c(),j[r].m(_,null))}for(;r<j.length;r+=1)j[r].d(1);j.length=G.length}},i:le,o:le,d(i){i&&(b(e),b(s),b(t)),ne(S,i),ne(j,i),I=!1,Ee(A)}}}function De(a){let e,l,s,t,n;function u(h){a[11](h)}function c(h){a[12](h)}function w(h){a[13](h)}let f={handleSearch:a[8],handleGetReview:a[9],storeData:a[5]};return a[4]!==void 0&&(f.pagesToFetch=a[4]),a[2]!==void 0&&(f.searchInputStr=a[2]),a[3]!==void 0&&(f.selectedStore=a[3]),e=new Oe({props:f}),$.push(()=>ee(e,"pagesToFetch",u)),$.push(()=>ee(e,"searchInputStr",c)),$.push(()=>ee(e,"selectedStore",w)),{c(){ge(e.$$.fragment)},l(h){be(e.$$.fragment,h)},m(h,k){pe(e,h,k),n=!0},p(h,k){const v={};k&32&&(v.storeData=h[5]),!l&&k&16&&(l=!0,v.pagesToFetch=h[4],te(()=>l=!1)),!s&&k&4&&(s=!0,v.searchInputStr=h[2],te(()=>s=!1)),!t&&k&8&&(t=!0,v.selectedStore=h[3],te(()=>t=!1)),e.$set(v)},i(h){n||(Z(e.$$.fragment,h),n=!0)},o(h){X(e.$$.fragment,h),n=!1},d(h){me(e,h)}}}function Re(a){let e,l;return e=new Ie({}),{c(){ge(e.$$.fragment)},l(s){be(e.$$.fragment,s)},m(s,t){pe(e,s,t),l=!0},p:le,i(s){l||(Z(e.$$.fragment,s),l=!0)},o(s){X(e.$$.fragment,s),l=!1},d(s){me(e,s)}}}function fe(a){let e,l=a[24]+"",s;return{c(){e=E("th"),s=K(l),this.h()},l(t){e=y(t,"TH",{class:!0});var n=U(e);s=P(n,l),n.forEach(b),this.h()},h(){C(e,"class","svelte-19sm30h")},m(t,n){z(t,e,n),d(e,s)},p(t,n){n&64&&l!==(l=t[24]+"")&&x(s,l)},d(t){t&&b(e)}}}function _e(a){let e,l=a[21]+"",s;return{c(){e=E("td"),s=K(l),this.h()},l(t){e=y(t,"TD",{class:!0});var n=U(e);s=P(n,l),n.forEach(b),this.h()},h(){C(e,"class","svelte-19sm30h")},m(t,n){z(t,e,n),d(e,s)},p(t,n){n&64&&l!==(l=t[21]+"")&&x(s,l)},d(t){t&&b(e)}}}function de(a){let e,l,s=q(Object.values(a[18])),t=[];for(let n=0;n<s.length;n+=1)t[n]=_e(he(a,s,n));return{c(){e=E("tr");for(let n=0;n<t.length;n+=1)t[n].c();l=L(),this.h()},l(n){e=y(n,"TR",{class:!0});var u=U(e);for(let c=0;c<t.length;c+=1)t[c].l(u);l=B(u),u.forEach(b),this.h()},h(){C(e,"class","svelte-19sm30h")},m(n,u){z(n,e,u);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);d(e,l)},p(n,u){if(u&64){s=q(Object.values(n[18]));let c;for(c=0;c<s.length;c+=1){const w=he(n,s,c);t[c]?t[c].p(w,u):(t[c]=_e(w),t[c].c(),t[c].m(e,l))}for(;c<t.length;c+=1)t[c].d(1);t.length=s.length}},d(n){n&&b(e),ne(t,n)}}}function Be(a){let e,l,s,t,n,u,c,w,f,h,k,v,F,H,p,O,N;se.title=e=a[0]+" - 榛果繽紛樂";const D=[Re,De,Ne],T=[];function M(o,m){return m&64&&(H=null),o[7]?0:(H==null&&(H=Object.keys(o[6]).length==0),H?1:2)}return p=M(a,-1),O=T[p]=D[p](a),{c(){l=L(),s=E("div"),t=E("img"),u=L(),c=E("div"),w=E("h1"),f=K(a[0]),h=L(),k=E("h2"),v=K(a[1]),F=L(),O.c(),this.h()},l(o){je("svelte-1kuv545",se.head).forEach(b),l=B(o),s=y(o,"DIV",{class:!0});var _=U(s);t=y(_,"IMG",{src:!0,alt:!0,style:!0}),u=B(_),c=y(_,"DIV",{class:!0});var I=U(c);w=y(I,"H1",{class:!0});var A=U(w);f=P(A,a[0]),A.forEach(b),h=B(I),k=y(I,"H2",{class:!0});var R=U(k);v=P(R,a[1]),R.forEach(b),I.forEach(b),F=B(_),O.l(_),_.forEach(b),this.h()},h(){Se(t.src,n="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png")||C(t,"src",n),C(t,"alt","GooMapReviewSnatcher"),ce(t,"width","100%"),ce(t,"max-width","150px"),C(w,"class","title svelte-19sm30h"),C(k,"class","subtitle svelte-19sm30h"),C(c,"class","title-box svelte-19sm30h"),C(s,"class","container svelte-19sm30h")},m(o,m){z(o,l,m),z(o,s,m),d(s,t),d(s,u),d(s,c),d(c,w),d(w,f),d(c,h),d(c,k),d(k,v),d(s,F),T[p].m(s,null),N=!0},p(o,[m]){(!N||m&1)&&e!==(e=o[0]+" - 榛果繽紛樂")&&(se.title=e),(!N||m&1)&&x(f,o[0]),(!N||m&2)&&x(v,o[1]);let _=p;p=M(o,m),p===_?T[p].p(o,m):(Ce(),X(T[_],1,1,()=>{T[_]=null}),Te(),O=T[p],O?O.p(o,m):(O=T[p]=D[p](o),O.c()),Z(O,1),O.m(s,null))},i(o){N||(Z(O),N=!0)},o(o){X(O),N=!1},d(o){o&&(b(l),b(s)),T[p].d()}}}const Le="/api/search",Fe="/api/reviews";function He(a,e,l){let{title:s}=e,{subtitle:t}=e,n="",u="",c=1,w=[],f=[],h=!1;const k=async()=>{if(l(7,h=!0),console.log(n),n===""){alert("請輸入搜尋關鍵字"),l(7,h=!1);return}try{const o=await fetch(Le+`?storeName=${n}`);if(!o.ok){console.error("Error:",o.statusText),alert("無法取得搜尋結果");return}l(5,w=await o.json()),console.log(w)}catch(o){console.error(o),alert("無法取得搜尋結果")}finally{l(7,h=!1)}},v=async()=>{if(l(7,h=!0),console.log(u),u===""){alert("請選擇店家"),l(7,h=!1);return}try{const o=await fetch(Fe+`?storeID=${u.ID}&pages=${c}`);if(!o.ok){console.error("Error:",o.statusText),alert("無法取得評論");return}l(6,f=await o.json()),console.log(f)}catch(o){console.error(o),alert("無法取得評論")}finally{l(7,h=!1)}},F=o=>{const m=document.createElement("a");let _="";switch(o){case"csv":const I=new Uint8Array([239,187,191]),A=Object.keys(f[0]).join(","),R=f.map(g=>Object.values(g).map(r=>typeof r=="string"&&(r.includes(",")||r.includes(`
`)||r.includes('"'))?`"${r.replace(/"/g,'""')}"`:r).join(",")),S=A+`
`+R.join(`
`),G=new Blob([I,S],{type:"text/csv;charset=utf-8"});_=window.URL.createObjectURL(G),m.href=_,m.download=`${u.Name}.csv`,m.click();break;case"json":const j=JSON.stringify(f,null,2),i=new Blob([j],{type:"application/json;charset=utf-8"});_=window.URL.createObjectURL(i),m.href=_,m.download=`${u.Name}.json`,m.click();break}window.URL.revokeObjectURL(_)};ye(async()=>{getNavbar()});function H(o){c=o,l(4,c)}function p(o){n=o,l(2,n)}function O(o){u=o,l(3,u)}const N=()=>{l(2,n=""),l(5,w=[]),l(6,f=[])},D=()=>F("csv"),T=()=>F("json"),M=async()=>{const o=f.map(A=>A.content);let m="";const _=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:u.Name,reviews:o})});if(_.ok)m=(await _.json()).dataUUID;else{console.error("Error:",_.statusText),alert("無法使用 StoreCoach 探勘");return}const I=document.createElement("a");I.href=`https://storecoach.hazelnut-paradise.com/review-mining/${m}`,I.target="_blank",I.click()};return a.$$set=o=>{"title"in o&&l(0,s=o.title),"subtitle"in o&&l(1,t=o.subtitle)},[s,t,n,u,c,w,f,h,k,v,F,H,p,O,N,D,T,M]}class ze extends ve{constructor(e){super(),we(this,e,He,Be,ke,{title:0,subtitle:1})}}export{ze as default};
