import{S as te,i as se,s as ne,d as j,t as F,b as B,r as P,e as re,h as Q,u as y,K as oe,v as D,H as W,L as ae,z as C,w as T,x as q,y as X,C as A,A as L,B as Y,q as le,o as ce,a as z,m as J,j as V,f as K,J as U,M as E,N as O,g as ie}from"../chunks/index-BcAQgaGx.js";import ue from"./InputCard-BxUagq9k.js";import fe from"./Loader-CT3sUNCL.js";import pe from"./Result-CnzIEkPG.js";import"../chunks/each-D6YF6ztN.js";import"./InfoCard-l3ckkPzU.js";import"./Redirecting-BYhZgEFO.js";const de=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{document:H}=de;function _e(r){let e,t,s;function u(n){r[16](n)}let p={selectedStore:r[3],download:r[11],handleReset:r[8]};return r[6]!==void 0&&(p.reviews=r[6]),e=new pe({props:p}),U.push(()=>E(e,"reviews",u)),{c(){K(e.$$.fragment)},l(n){V(e.$$.fragment,n)},m(n,c){J(e,n,c),s=!0},p(n,c){const i={};c&8&&(i.selectedStore=n[3]),!t&&c&64&&(t=!0,i.reviews=n[6],O(()=>t=!1)),e.$set(i)},i(n){s||(B(e.$$.fragment,n),s=!0)},o(n){F(e.$$.fragment,n),s=!1},d(n){z(e,n)}}}function he(r){let e,t,s,u,p,n;function c(a){r[12](a)}function i(a){r[13](a)}function d(a){r[14](a)}function m(a){r[15](a)}let _={handleSearch:r[9],handleGetReview:r[10]};return r[2]!==void 0&&(_.searchInputStr=r[2]),r[3]!==void 0&&(_.selectedStore=r[3]),r[5]!==void 0&&(_.storeData=r[5]),r[4]!==void 0&&(_.pagesToFetch=r[4]),e=new ue({props:_}),U.push(()=>E(e,"searchInputStr",c)),U.push(()=>E(e,"selectedStore",i)),U.push(()=>E(e,"storeData",d)),U.push(()=>E(e,"pagesToFetch",m)),{c(){K(e.$$.fragment)},l(a){V(e.$$.fragment,a)},m(a,b){J(e,a,b),n=!0},p(a,b){const w={};!t&&b&4&&(t=!0,w.searchInputStr=a[2],O(()=>t=!1)),!s&&b&8&&(s=!0,w.selectedStore=a[3],O(()=>s=!1)),!u&&b&32&&(u=!0,w.storeData=a[5],O(()=>u=!1)),!p&&b&16&&(p=!0,w.pagesToFetch=a[4],O(()=>p=!1)),e.$set(w)},i(a){n||(B(e.$$.fragment,a),n=!0)},o(a){F(e.$$.fragment,a),n=!1},d(a){z(e,a)}}}function ge(r){let e,t;return e=new fe({}),{c(){K(e.$$.fragment)},l(s){V(e.$$.fragment,s)},m(s,u){J(e,s,u),t=!0},p:ce,i(s){t||(B(e.$$.fragment,s),t=!0)},o(s){F(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function me(r){let e,t,s,u,p,n,c,i,d,m,_,a,b,w,h,g,v;H.title=e=r[0]+" - 榛果繽紛樂";const M=[ge,he,_e],S=[];function o(l,f){return f&64&&(w=null),l[7]?0:(w==null&&(w=Object.keys(l[6]).length==0),w?1:2)}return h=o(r,-1),g=S[h]=M[h](r),{c(){t=A(),s=L("div"),u=L("img"),n=A(),c=L("div"),i=L("h1"),d=Y(r[0]),m=A(),_=L("h2"),a=Y(r[1]),b=A(),g.c(),this.h()},l(l){ae("svelte-1kuv545",H.head).forEach(j),t=C(l),s=T(l,"DIV",{class:!0});var k=q(s);u=T(k,"IMG",{src:!0,alt:!0,style:!0}),n=C(k),c=T(k,"DIV",{class:!0});var R=q(c);i=T(R,"H1",{class:!0});var N=q(i);d=X(N,r[0]),N.forEach(j),m=C(R),_=T(R,"H2",{class:!0});var G=q(_);a=X(G,r[1]),G.forEach(j),R.forEach(j),b=C(k),g.l(k),k.forEach(j),this.h()},h(){oe(u.src,p="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png")||D(u,"src",p),D(u,"alt","GooMapReviewSnatcher"),W(u,"width","100%"),W(u,"max-width","150px"),D(i,"class","title svelte-fc3bky"),D(_,"class","subtitle svelte-fc3bky"),D(c,"class","title-box svelte-fc3bky"),D(s,"class","container svelte-fc3bky")},m(l,f){Q(l,t,f),Q(l,s,f),y(s,u),y(s,n),y(s,c),y(c,i),y(i,d),y(c,m),y(c,_),y(_,a),y(s,b),S[h].m(s,null),v=!0},p(l,[f]){(!v||f&1)&&e!==(e=l[0]+" - 榛果繽紛樂")&&(H.title=e),(!v||f&1)&&P(d,l[0]),(!v||f&2)&&P(a,l[1]);let k=h;h=o(l,f),h===k?S[h].p(l,f):(ie(),F(S[k],1,1,()=>{S[k]=null}),re(),g=S[h],g?g.p(l,f):(g=S[h]=M[h](l),g.c()),B(g,1),g.m(s,null))},i(l){v||(B(g),v=!0)},o(l){F(g),v=!1},d(l){l&&(j(t),j(s)),S[h].d()}}}const be="/api/search",we="/api/reviews";function ke(r,e,t){let{title:s}=e,{subtitle:u}=e,p="",n="",c=1,i=[],d=[],m=!1;const _=()=>{t(2,p=""),t(3,n=""),t(4,c=1),t(5,i=[]),t(6,d=[])},a=async()=>{if(t(7,m=!0),console.log(p),p===""){alert("請輸入搜尋關鍵字"),t(7,m=!1);return}try{const o=await fetch(be+`?storeName=${p}`);if(!o.ok){console.error("Error:",o.statusText),alert("無法取得搜尋結果");return}t(5,i=await o.json()),console.log(i),i.length>0&&t(3,n=i[0])}catch(o){console.error(o),alert("無法取得搜尋結果")}finally{t(7,m=!1)}},b=async()=>{if(t(7,m=!0),console.log(n),n===""){alert("請選擇店家"),t(7,m=!1);return}try{const o=await fetch(we+`?storeID=${n.ID}&pages=${c}`);if(!o.ok){console.error("Error:",o.statusText),alert("無法取得評論");return}t(6,d=await o.json()),console.log(d)}catch(o){console.error(o),alert("無法取得評論")}finally{t(7,m=!1)}},w=o=>{const l=document.createElement("a");let f="";switch(o){case"csv":const k=new Uint8Array([239,187,191]),R=Object.keys(d[0]).join(","),N=d.map(ee=>Object.values(ee).map(I=>typeof I=="string"&&(I.includes(",")||I.includes(`
`)||I.includes('"'))?`"${I.replace(/"/g,'""')}"`:I).join(",")),G=R+`
`+N.join(`
`),Z=new Blob([k,G],{type:"text/csv;charset=utf-8"});f=window.URL.createObjectURL(Z),l.href=f,l.download=`${n.Name}.csv`,l.click();break;case"json":const $=JSON.stringify(d,null,2),x=new Blob([$],{type:"application/json;charset=utf-8"});f=window.URL.createObjectURL(x),l.href=f,l.download=`${n.Name}.json`,l.click();break}window.URL.revokeObjectURL(f)};le(async()=>{getNavbar()});function h(o){p=o,t(2,p)}function g(o){n=o,t(3,n)}function v(o){i=o,t(5,i)}function M(o){c=o,t(4,c)}function S(o){d=o,t(6,d)}return r.$$set=o=>{"title"in o&&t(0,s=o.title),"subtitle"in o&&t(1,u=o.subtitle)},[s,u,p,n,c,i,d,m,_,a,b,w,h,g,v,M,S]}class Te extends te{constructor(e){super(),se(this,e,ke,me,ne,{title:0,subtitle:1})}}export{Te as default};
