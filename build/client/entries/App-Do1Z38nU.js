import{l as dt,b as ht,H as ut,e as bt,t as g,f as F,h as k,d as f,g as ft,m as t,o as p,j as i,$ as pt,k as s,c as mt,q as a}from"../chunks/template-Ck2fRipi.js";import{s as w}from"../chunks/render-B3o7HRdp.js";import{a as kt,i as J}from"../chunks/lifecycle-BJN0pLMS.js";import{I as wt,e as I,a as N,i as T}from"../chunks/InputCard-BkRnv2Wa.js";import{p as V}from"../chunks/props-8vpwuoM1.js";import{o as gt}from"../chunks/index-client-07cMjNGe.js";import _t from"./Loader-CFgeOWCn.js";import"./InfoCard-DsmM0Zsi.js";function yt(q){var u;u=document.head.appendChild(dt());try{ht(()=>q(u),ut)}finally{}}var xt=g('<th class="svelte-vqnkcd"> </th>'),qt=g('<td class="svelte-vqnkcd"> </td>'),jt=g('<tr class="svelte-vqnkcd"></tr>'),St=g('<button class="reset-button button svelte-vqnkcd">查詢其他商家</button> <div class="review-box svelte-vqnkcd"><h3 class="store-name svelte-vqnkcd"> </h3> <button class="download-button button svelte-vqnkcd">下載 CSV</button> <button class="download-button button svelte-vqnkcd">下載 JSON</button> <div class="review-table-box svelte-vqnkcd"><table class="review-table svelte-vqnkcd"><thead class="svelte-vqnkcd"><tr class="svelte-vqnkcd"></tr></thead><tbody class="svelte-vqnkcd"></tbody></table></div></div>',1),Ot=g('<div class="container svelte-vqnkcd"><img src="https://src.hazelnut-paradise.com/GooMapReviewSnatcher.png" alt="GooMapReviewSnatcher" style="width: 100%; max-width: 150px;" class="svelte-vqnkcd"> <div class="title-box svelte-vqnkcd"><h1 class="title svelte-vqnkcd"> </h1> <h2 class="subtitle svelte-vqnkcd"> </h2></div> <!></div> <div id="navbar-placeholder" style="height: 50px; z-index: 100;" class="svelte-vqnkcd"></div> <footer class="svelte-vqnkcd">2025 - 榛果繽紛樂</footer>',1);function Tt(q,u){bt(u,!1);let C=V(u,"title",8),K=V(u,"subtitle",8);const P="/api/search",Q="/api/reviews";let b=p(""),l=p(""),j=p(1),_=p([]),o=p([]),d=p(!1);const W=async()=>{if(a(d,!0),console.log(t(b)),t(b)===""){alert("請輸入搜尋關鍵字"),a(d,!1);return}try{const e=await fetch(P+`?storeName=${t(b)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得搜尋結果");return}a(_,await e.json()),console.log(t(_))}catch(e){console.error(e),alert("無法取得搜尋結果")}finally{a(d,!1)}},X=async()=>{if(a(d,!0),console.log(t(l)),t(l)===""){alert("請選擇店家"),a(d,!1);return}try{const e=await fetch(Q+`?storeID=${t(l).ID}&pages=${t(j)}`);if(!e.ok){console.error("Error:",e.statusText),alert("無法取得評論");return}a(o,await e.json()),console.log(t(o))}catch(e){console.error(e),alert("無法取得評論")}finally{a(d,!1)}},D=e=>{const n=document.createElement("a");let h="";switch(e){case"csv":const S=new Uint8Array([239,187,191]),O=Object.keys(t(o)[0]).join(","),v=t(o).map(U=>Object.values(U).map(c=>typeof c=="string"&&(c.includes(",")||c.includes(`
`)||c.includes('"'))?`"${c.replace(/"/g,'""')}"`:c).join(",")),r=O+`
`+v.join(`
`),y=new Blob([S,r],{type:"text/csv;charset=utf-8"});h=window.URL.createObjectURL(y),n.href=h,n.download=`${t(l).Name}.csv`,n.click();break;case"json":const R=JSON.stringify(t(o),null,2),x=new Blob([R],{type:"application/json;charset=utf-8"});h=window.URL.createObjectURL(x),n.href=h,n.download=`${t(l).Name}.json`,n.click();break}window.URL.revokeObjectURL(h)};gt(async()=>{getNavbar()}),kt();var $=Ot();yt(e=>{k(()=>pt.title=`${C()??""} - 榛果繽紛樂`)});var Y=F($),M=i(s(Y),2),A=s(M),Z=s(A),tt=i(A,2),et=s(tt),at=i(M,2);{var st=e=>{_t(e)},rt=e=>{var n=mt(),h=F(n);{var S=v=>{wt(v,{handleSearch:W,handleGetReview:X,get storeData(){return t(_)},get pagesToFetch(){return t(j)},set pagesToFetch(r){a(j,r)},get searchInputStr(){return t(b)},set searchInputStr(r){a(b,r)},get selectedStore(){return t(l)},set selectedStore(r){a(l,r)},$$legacy:!0})},O=v=>{var r=St(),y=F(r),R=i(y,2),x=s(R),U=s(x),c=i(x,2),G=i(c,2),ot=i(G,2),nt=s(ot),z=s(nt),ct=s(z);I(ct,5,()=>Object.keys(t(o)[0]),T,(B,L)=>{var m=xt(),E=s(m);k(()=>w(E,t(L))),f(B,m)});var lt=i(z);I(lt,5,()=>t(o),T,(B,L)=>{var m=jt();I(m,5,()=>Object.values(t(L)),T,(E,vt)=>{var H=qt(),it=s(H);k(()=>w(it,t(vt))),f(E,H)}),f(B,m)}),k(()=>w(U,t(l).Name)),N("click",y,()=>{a(b,""),a(_,[]),a(o,[])}),N("click",c,()=>D("csv")),N("click",G,()=>D("json")),f(v,r)};J(h,v=>{Object.keys(t(o)).length==0?v(S):v(O,!1)},!0)}f(e,n)};J(at,e=>{t(d)?e(st):e(rt,!1)})}k(()=>{w(Z,C()),w(et,K())}),f(q,$),ft()}export{Tt as default};
