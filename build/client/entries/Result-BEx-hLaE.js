import{S as fe,i as _e,s as de,d as h,t as X,b as Z,e as me,h as E,k as K,q as ve,o as $,a as be,m as ge,j as ke,f as pe,O as ee,P as we,r as A,u as d,U as F,v as p,w as b,I as G,z as H,x as y,y as V,A as g,C as x,B as J,H as he,Y as ye,g as Te}from"../chunks/index-BcAQgaGx.js";import{e as q}from"../chunks/each-D6YF6ztN.js";import Ce from"./Redirecting-DECyv3Gs.js";import"./Loader-CT3sUNCL.js";function oe(o,e,s){const n=o.slice();return n[10]=e[s],n}function ae(o,e,s){const n=o.slice();return n[13]=e[s],n}function ie(o,e,s){const n=o.slice();return n[16]=e[s],n}function Ee(o){let e,s="查詢其他商家",n,t,l,r=o[0].Name+"",i,u,f,S="下載 CSV",L,T,k="下載 JSON",M,C,P="使用 <strong>StoreCoach</strong> 探勘",R,O,w,z,U,Q,B,W,te,D=q(Object.keys(o[1][0])),m=[];for(let c=0;c<D.length;c+=1)m[c]=re(ie(o,D,c));let I=q(o[1]),v=[];for(let c=0;c<I.length;c+=1)v[c]=ue(oe(o,I,c));return{c(){e=g("button"),e.textContent=s,n=x(),t=g("div"),l=g("h3"),i=J(r),u=x(),f=g("button"),f.textContent=S,L=x(),T=g("button"),T.textContent=k,M=x(),C=g("button"),C.innerHTML=P,R=x(),O=g("div"),w=g("table"),z=g("thead"),U=g("tr");for(let c=0;c<m.length;c+=1)m[c].c();Q=x(),B=g("tbody");for(let c=0;c<v.length;c+=1)v[c].c();this.h()},l(c){e=b(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1z0u94t"&&(e.textContent=s),n=H(c),t=b(c,"DIV",{class:!0});var _=y(t);l=b(_,"H3",{class:!0});var a=y(l);i=V(a,r),a.forEach(h),u=H(_),f=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(f)!=="svelte-15p6db5"&&(f.textContent=S),L=H(_),T=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(T)!=="svelte-osw2el"&&(T.textContent=k),M=H(_),C=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(C)!=="svelte-1a53k2q"&&(C.innerHTML=P),R=H(_),O=b(_,"DIV",{class:!0});var N=y(O);w=b(N,"TABLE",{class:!0});var Y=y(w);z=b(Y,"THEAD",{});var le=y(z);U=b(le,"TR",{class:!0});var ne=y(U);for(let j=0;j<m.length;j+=1)m[j].l(ne);ne.forEach(h),le.forEach(h),Q=H(Y),B=b(Y,"TBODY",{});var se=y(B);for(let j=0;j<v.length;j+=1)v[j].l(se);se.forEach(h),Y.forEach(h),N.forEach(h),_.forEach(h),this.h()},h(){p(e,"class","reset-button button svelte-1d9uiic"),p(l,"class","store-name svelte-1d9uiic"),p(f,"class","download-button button svelte-1d9uiic"),p(T,"class","download-button button svelte-1d9uiic"),p(C,"class","mining-button button svelte-1d9uiic"),p(U,"class","svelte-1d9uiic"),p(w,"class","review-table svelte-1d9uiic"),p(O,"class","review-table-box svelte-1d9uiic"),p(t,"class","review-box svelte-1d9uiic")},m(c,_){E(c,e,_),E(c,n,_),E(c,t,_),d(t,l),d(l,i),d(t,u),d(t,f),d(t,L),d(t,T),d(t,M),d(t,C),d(t,R),d(t,O),d(O,w),d(w,z),d(z,U);for(let a=0;a<m.length;a+=1)m[a]&&m[a].m(U,null);d(w,Q),d(w,B);for(let a=0;a<v.length;a+=1)v[a]&&v[a].m(B,null);W||(te=[F(e,"click",function(){ye(o[3])&&o[3].apply(this,arguments)}),F(f,"click",o[6]),F(T,"click",o[7]),F(C,"click",o[8])],W=!0)},p(c,_){if(o=c,_&1&&r!==(r=o[0].Name+"")&&A(i,r),_&2){D=q(Object.keys(o[1][0]));let a;for(a=0;a<D.length;a+=1){const N=ie(o,D,a);m[a]?m[a].p(N,_):(m[a]=re(N),m[a].c(),m[a].m(U,null))}for(;a<m.length;a+=1)m[a].d(1);m.length=D.length}if(_&2){I=q(o[1]);let a;for(a=0;a<I.length;a+=1){const N=oe(o,I,a);v[a]?v[a].p(N,_):(v[a]=ue(N),v[a].c(),v[a].m(B,null))}for(;a<v.length;a+=1)v[a].d(1);v.length=I.length}},i:$,o:$,d(c){c&&(h(e),h(n),h(t)),ee(m,c),ee(v,c),W=!1,we(te)}}}function Oe(o){let e,s;return e=new Ce({}),{c(){pe(e.$$.fragment)},l(n){ke(e.$$.fragment,n)},m(n,t){ge(e,n,t),s=!0},p:$,i(n){s||(Z(e.$$.fragment,n),s=!0)},o(n){X(e.$$.fragment,n),s=!1},d(n){be(e,n)}}}function Se(o){let e,s=o[16]+"",n;return{c(){e=g("th"),n=J(s),this.h()},l(t){e=b(t,"TH",{class:!0});var l=y(e);n=V(l,s),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){E(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&A(n,s)},d(t){t&&h(e)}}}function Ne(o){let e,s=o[16]+"",n;return{c(){e=g("th"),n=J(s),this.h()},l(t){e=b(t,"TH",{style:!0,class:!0});var l=y(e);n=V(l,s),l.forEach(h),this.h()},h(){he(e,"min-width","400px"),p(e,"class","svelte-1d9uiic")},m(t,l){E(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&A(n,s)},d(t){t&&h(e)}}}function Re(o){let e,s=o[16]+"",n;return{c(){e=g("th"),n=J(s),this.h()},l(t){e=b(t,"TH",{style:!0,class:!0});var l=y(e);n=V(l,s),l.forEach(h),this.h()},h(){he(e,"min-width","500px"),p(e,"class","svelte-1d9uiic")},m(t,l){E(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&A(n,s)},d(t){t&&h(e)}}}function re(o){let e;function s(l,r){return l[16]==="content"?Re:l[16]==="reviewer_id"?Ne:Se}let n=s(o),t=n(o);return{c(){t.c(),e=K()},l(l){t.l(l),e=K()},m(l,r){t.m(l,r),E(l,e,r)},p(l,r){n===(n=s(l))&&t?t.p(l,r):(t.d(1),t=n(l),t&&(t.c(),t.m(e.parentNode,e)))},d(l){l&&h(e),t.d(l)}}}function ce(o){let e,s=o[13]+"",n;return{c(){e=g("td"),n=J(s),this.h()},l(t){e=b(t,"TD",{class:!0});var l=y(e);n=V(l,s),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){E(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[13]+"")&&A(n,s)},d(t){t&&h(e)}}}function ue(o){let e,s,n=q(Object.values(o[10])),t=[];for(let l=0;l<n.length;l+=1)t[l]=ce(ae(o,n,l));return{c(){e=g("tr");for(let l=0;l<t.length;l+=1)t[l].c();s=x(),this.h()},l(l){e=b(l,"TR",{class:!0});var r=y(e);for(let i=0;i<t.length;i+=1)t[i].l(r);s=H(r),r.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(l,r){E(l,e,r);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null);d(e,s)},p(l,r){if(r&2){n=q(Object.values(l[10]));let i;for(i=0;i<n.length;i+=1){const u=ae(l,n,i);t[i]?t[i].p(u,r):(t[i]=ce(u),t[i].c(),t[i].m(e,s))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(l){l&&h(e),ee(t,l)}}}function Ue(o){let e,s,n,t;const l=[Oe,Ee],r=[];function i(u,f){return u[4]?0:1}return e=i(o),s=r[e]=l[e](o),{c(){s.c(),n=K()},l(u){s.l(u),n=K()},m(u,f){r[e].m(u,f),E(u,n,f),t=!0},p(u,[f]){let S=e;e=i(u),e===S?r[e].p(u,f):(Te(),X(r[S],1,1,()=>{r[S]=null}),me(),s=r[e],s?s.p(u,f):(s=r[e]=l[e](u),s.c()),Z(s,1),s.m(n.parentNode,n))},i(u){t||(Z(s),t=!0)},o(u){X(s),t=!1},d(u){u&&h(n),r[e].d(u)}}}function je(o,e,s){let{selectedStore:n}=e,{reviews:t}=e,{download:l}=e,{handleReset:r}=e,i=!1;const u=async k=>{s(4,i=!0);const[M,C]=t.map(w=>[w.content,w.rating]);let P="";const R=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:n.Name,reviews:M,ratings:C})});if(R.ok)P=(await R.json()).dataUUID;else{console.error("Error:",R.statusText),alert("無法使用 StoreCoach 探勘");return}const O=`https://storecoach.hazelnut-paradise.com/review-mining/${P}`;k?window.open(O,"_blank"):window.open(O,"_self"),s(4,i=!1)};let f={};ve(async()=>{const k=new URLSearchParams(window.location.search);f=Object.fromEntries(k.entries()),console.log(f),f.mode&&f.mode==="storecoach"&&await u(!1)});const S=()=>l("csv"),L=()=>l("json"),T=()=>u(!0);return o.$$set=k=>{"selectedStore"in k&&s(0,n=k.selectedStore),"reviews"in k&&s(1,t=k.reviews),"download"in k&&s(2,l=k.download),"handleReset"in k&&s(3,r=k.handleReset)},[n,t,l,r,i,u,S,L,T]}class Ie extends fe{constructor(e){super(),_e(this,e,je,Ue,de,{selectedStore:0,reviews:1,download:2,handleReset:3})}}export{Ie as default};
