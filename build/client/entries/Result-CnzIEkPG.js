import{S as fe,i as _e,s as de,d as h,t as X,b as Z,e as me,h as O,k as K,q as ve,o as $,a as be,m as ge,j as ke,f as pe,O as ee,P as we,r as P,u as d,U as F,v as p,w as g,I as G,z as x,x as w,y as V,A as k,C as B,B as J,H as he,Y as ye,g as Te}from"../chunks/index-BcAQgaGx.js";import{e as A}from"../chunks/each-D6YF6ztN.js";import Ce from"./Redirecting-BYhZgEFO.js";import"./Loader-CT3sUNCL.js";function oe(o,e,n){const s=o.slice();return s[10]=e[n],s}function ae(o,e,n){const s=o.slice();return s[13]=e[n],s}function ie(o,e,n){const s=o.slice();return s[16]=e[n],s}function Ee(o){let e,n="查詢其他商家",s,t,l,r=o[0].Name+"",i,u,f,N="下載 CSV",L,T,b="下載 JSON",M,C,z="使用 <strong>StoreCoach</strong> 探勘",U,S,y,E,j,Q,D,W,te,I=A(Object.keys(o[1][0])),m=[];for(let c=0;c<I.length;c+=1)m[c]=re(ie(o,I,c));let q=A(o[1]),v=[];for(let c=0;c<q.length;c+=1)v[c]=ue(oe(o,q,c));return{c(){e=k("button"),e.textContent=n,s=B(),t=k("div"),l=k("h3"),i=J(r),u=B(),f=k("button"),f.textContent=N,L=B(),T=k("button"),T.textContent=b,M=B(),C=k("button"),C.innerHTML=z,U=B(),S=k("div"),y=k("table"),E=k("thead"),j=k("tr");for(let c=0;c<m.length;c+=1)m[c].c();Q=B(),D=k("tbody");for(let c=0;c<v.length;c+=1)v[c].c();this.h()},l(c){e=g(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1z0u94t"&&(e.textContent=n),s=x(c),t=g(c,"DIV",{class:!0});var _=w(t);l=g(_,"H3",{class:!0});var a=w(l);i=V(a,r),a.forEach(h),u=x(_),f=g(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(f)!=="svelte-15p6db5"&&(f.textContent=N),L=x(_),T=g(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(T)!=="svelte-osw2el"&&(T.textContent=b),M=x(_),C=g(_,"BUTTON",{class:!0,"data-svelte-h":!0}),G(C)!=="svelte-1a53k2q"&&(C.innerHTML=z),U=x(_),S=g(_,"DIV",{class:!0});var R=w(S);y=g(R,"TABLE",{class:!0});var Y=w(y);E=g(Y,"THEAD",{});var le=w(E);j=g(le,"TR",{class:!0});var ne=w(j);for(let H=0;H<m.length;H+=1)m[H].l(ne);ne.forEach(h),le.forEach(h),Q=x(Y),D=g(Y,"TBODY",{});var se=w(D);for(let H=0;H<v.length;H+=1)v[H].l(se);se.forEach(h),Y.forEach(h),R.forEach(h),_.forEach(h),this.h()},h(){p(e,"class","reset-button button svelte-1d9uiic"),p(l,"class","store-name svelte-1d9uiic"),p(f,"class","download-button button svelte-1d9uiic"),p(T,"class","download-button button svelte-1d9uiic"),p(C,"class","mining-button button svelte-1d9uiic"),p(j,"class","svelte-1d9uiic"),p(y,"class","review-table svelte-1d9uiic"),p(S,"class","review-table-box svelte-1d9uiic"),p(t,"class","review-box svelte-1d9uiic")},m(c,_){O(c,e,_),O(c,s,_),O(c,t,_),d(t,l),d(l,i),d(t,u),d(t,f),d(t,L),d(t,T),d(t,M),d(t,C),d(t,U),d(t,S),d(S,y),d(y,E),d(E,j);for(let a=0;a<m.length;a+=1)m[a]&&m[a].m(j,null);d(y,Q),d(y,D);for(let a=0;a<v.length;a+=1)v[a]&&v[a].m(D,null);W||(te=[F(e,"click",function(){ye(o[3])&&o[3].apply(this,arguments)}),F(f,"click",o[6]),F(T,"click",o[7]),F(C,"click",o[8])],W=!0)},p(c,_){if(o=c,_&1&&r!==(r=o[0].Name+"")&&P(i,r),_&2){I=A(Object.keys(o[1][0]));let a;for(a=0;a<I.length;a+=1){const R=ie(o,I,a);m[a]?m[a].p(R,_):(m[a]=re(R),m[a].c(),m[a].m(j,null))}for(;a<m.length;a+=1)m[a].d(1);m.length=I.length}if(_&2){q=A(o[1]);let a;for(a=0;a<q.length;a+=1){const R=oe(o,q,a);v[a]?v[a].p(R,_):(v[a]=ue(R),v[a].c(),v[a].m(D,null))}for(;a<v.length;a+=1)v[a].d(1);v.length=q.length}},i:$,o:$,d(c){c&&(h(e),h(s),h(t)),ee(m,c),ee(v,c),W=!1,we(te)}}}function Oe(o){let e,n;return e=new Ce({}),{c(){pe(e.$$.fragment)},l(s){ke(e.$$.fragment,s)},m(s,t){ge(e,s,t),n=!0},p:$,i(s){n||(Z(e.$$.fragment,s),n=!0)},o(s){X(e.$$.fragment,s),n=!1},d(s){be(e,s)}}}function Se(o){let e,n=o[16]+"",s;return{c(){e=k("th"),s=J(n),this.h()},l(t){e=g(t,"TH",{class:!0});var l=w(e);s=V(l,n),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,s)},p(t,l){l&2&&n!==(n=t[16]+"")&&P(s,n)},d(t){t&&h(e)}}}function Ne(o){let e,n=o[16]+"",s;return{c(){e=k("th"),s=J(n),this.h()},l(t){e=g(t,"TH",{style:!0,class:!0});var l=w(e);s=V(l,n),l.forEach(h),this.h()},h(){he(e,"min-width","400px"),p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,s)},p(t,l){l&2&&n!==(n=t[16]+"")&&P(s,n)},d(t){t&&h(e)}}}function Re(o){let e,n=o[16]+"",s;return{c(){e=k("th"),s=J(n),this.h()},l(t){e=g(t,"TH",{style:!0,class:!0});var l=w(e);s=V(l,n),l.forEach(h),this.h()},h(){he(e,"min-width","500px"),p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,s)},p(t,l){l&2&&n!==(n=t[16]+"")&&P(s,n)},d(t){t&&h(e)}}}function re(o){let e;function n(l,r){return l[16]==="content"?Re:l[16]==="reviewer_id"?Ne:Se}let s=n(o),t=s(o);return{c(){t.c(),e=K()},l(l){t.l(l),e=K()},m(l,r){t.m(l,r),O(l,e,r)},p(l,r){s===(s=n(l))&&t?t.p(l,r):(t.d(1),t=s(l),t&&(t.c(),t.m(e.parentNode,e)))},d(l){l&&h(e),t.d(l)}}}function ce(o){let e,n=o[13]+"",s;return{c(){e=k("td"),s=J(n),this.h()},l(t){e=g(t,"TD",{class:!0});var l=w(e);s=V(l,n),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,s)},p(t,l){l&2&&n!==(n=t[13]+"")&&P(s,n)},d(t){t&&h(e)}}}function ue(o){let e,n,s=A(Object.values(o[10])),t=[];for(let l=0;l<s.length;l+=1)t[l]=ce(ae(o,s,l));return{c(){e=k("tr");for(let l=0;l<t.length;l+=1)t[l].c();n=B(),this.h()},l(l){e=g(l,"TR",{class:!0});var r=w(e);for(let i=0;i<t.length;i+=1)t[i].l(r);n=x(r),r.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(l,r){O(l,e,r);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null);d(e,n)},p(l,r){if(r&2){s=A(Object.values(l[10]));let i;for(i=0;i<s.length;i+=1){const u=ae(l,s,i);t[i]?t[i].p(u,r):(t[i]=ce(u),t[i].c(),t[i].m(e,n))}for(;i<t.length;i+=1)t[i].d(1);t.length=s.length}},d(l){l&&h(e),ee(t,l)}}}function Ue(o){let e,n,s,t;const l=[Oe,Ee],r=[];function i(u,f){return u[4]?0:1}return e=i(o),n=r[e]=l[e](o),{c(){n.c(),s=K()},l(u){n.l(u),s=K()},m(u,f){r[e].m(u,f),O(u,s,f),t=!0},p(u,[f]){let N=e;e=i(u),e===N?r[e].p(u,f):(Te(),X(r[N],1,1,()=>{r[N]=null}),me(),n=r[e],n?n.p(u,f):(n=r[e]=l[e](u),n.c()),Z(n,1),n.m(s.parentNode,s))},i(u){t||(Z(n),t=!0)},o(u){X(n),t=!1},d(u){u&&h(s),r[e].d(u)}}}function je(o,e,n){let{selectedStore:s}=e,{reviews:t}=e,{download:l}=e,{handleReset:r}=e,i=!1;const u=async b=>{n(4,i=!0);const M=t.map(E=>E.content),C=t.map(E=>E.rating);let z="";const U=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:s.Name,reviews:M,ratings:C})});if(U.ok)z=(await U.json()).dataUUID;else{console.error("Error:",U.statusText),alert("無法使用 StoreCoach 探勘"),n(4,i=!1);return}const S=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),y=`https://storecoach.hazelnut-paradise.com/review-mining/${z}`;b&&!S?window.open(y,"_blank"):window.open(y,"_self"),b&&!S&&n(4,i=!1)};let f={};ve(async()=>{const b=new URLSearchParams(window.location.search);f=Object.fromEntries(b.entries()),console.log(f),f.mode&&f.mode==="storecoach"&&await u(!1)});const N=()=>l("csv"),L=()=>l("json"),T=()=>u(!0);return o.$$set=b=>{"selectedStore"in b&&n(0,s=b.selectedStore),"reviews"in b&&n(1,t=b.reviews),"download"in b&&n(2,l=b.download),"handleReset"in b&&n(3,r=b.handleReset)},[s,t,l,r,i,u,N,L,T]}class Ie extends fe{constructor(e){super(),_e(this,e,je,Ue,de,{selectedStore:0,reviews:1,download:2,handleReset:3})}}export{Ie as default};
