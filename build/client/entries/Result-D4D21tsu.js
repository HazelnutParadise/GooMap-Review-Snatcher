import{S as he,i as ue,s as fe,o as te,d as u,J as W,K as de,r as A,h as E,u as d,O as Q,v as g,w as v,Q as Y,z as j,x as k,y as J,A as b,C as R,B as M,q as _e,k as le,E as ie,U as me}from"../chunks/index-BtOapRR_.js";import{e as I}from"../chunks/each-D6YF6ztN.js";function se(a,t,n){const s=a.slice();return s[9]=t[n],s}function ne(a,t,n){const s=a.slice();return s[12]=t[n],s}function ae(a,t,n){const s=a.slice();return s[15]=t[n],s}function ve(a){let t,n=a[15]+"",s;return{c(){t=b("th"),s=M(n),this.h()},l(e){t=v(e,"TH",{class:!0});var l=k(t);s=J(l,n),l.forEach(u),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){E(e,t,l),d(t,s)},p(e,l){l&2&&n!==(n=e[15]+"")&&A(s,n)},d(e){e&&u(t)}}}function be(a){let t,n=a[15]+"",s;return{c(){t=b("th"),s=M(n),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=k(t);s=J(l,n),l.forEach(u),this.h()},h(){ie(t,"min-width","400px"),g(t,"class","svelte-14r8um9")},m(e,l){E(e,t,l),d(t,s)},p(e,l){l&2&&n!==(n=e[15]+"")&&A(s,n)},d(e){e&&u(t)}}}function ge(a){let t,n=a[15]+"",s;return{c(){t=b("th"),s=M(n),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=k(t);s=J(l,n),l.forEach(u),this.h()},h(){ie(t,"min-width","500px"),g(t,"class","svelte-14r8um9")},m(e,l){E(e,t,l),d(t,s)},p(e,l){l&2&&n!==(n=e[15]+"")&&A(s,n)},d(e){e&&u(t)}}}function re(a){let t;function n(l,i){return l[15]==="content"?ge:l[15]==="reviewer_id"?be:ve}let s=n(a),e=s(a);return{c(){e.c(),t=le()},l(l){e.l(l),t=le()},m(l,i){e.m(l,i),E(l,t,i)},p(l,i){s===(s=n(l))&&e?e.p(l,i):(e.d(1),e=s(l),e&&(e.c(),e.m(t.parentNode,t)))},d(l){l&&u(t),e.d(l)}}}function oe(a){let t,n=a[12]+"",s;return{c(){t=b("td"),s=M(n),this.h()},l(e){t=v(e,"TD",{class:!0});var l=k(t);s=J(l,n),l.forEach(u),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){E(e,t,l),d(t,s)},p(e,l){l&2&&n!==(n=e[12]+"")&&A(s,n)},d(e){e&&u(t)}}}function ce(a){let t,n,s=I(Object.values(a[9])),e=[];for(let l=0;l<s.length;l+=1)e[l]=oe(ne(a,s,l));return{c(){t=b("tr");for(let l=0;l<e.length;l+=1)e[l].c();n=R(),this.h()},l(l){t=v(l,"TR",{class:!0});var i=k(t);for(let c=0;c<e.length;c+=1)e[c].l(i);n=j(i),i.forEach(u),this.h()},h(){g(t,"class","svelte-14r8um9")},m(l,i){E(l,t,i);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);d(t,n)},p(l,i){if(i&2){s=I(Object.values(l[9]));let c;for(c=0;c<s.length;c+=1){const w=ne(l,s,c);e[c]?e[c].p(w,i):(e[c]=oe(w),e[c].c(),e[c].m(t,n))}for(;c<e.length;c+=1)e[c].d(1);e.length=s.length}},d(l){l&&u(t),W(e,l)}}}function ke(a){let t,n="查詢其他商家",s,e,l,i=a[0].Name+"",c,w,y,P="下載 CSV",L,h,V="下載 JSON",q,T,x="使用 <strong>StoreCoach</strong> 探勘",S,p,C,z,N,F,B,G,X,D=I(Object.keys(a[1][0])),_=[];for(let o=0;o<D.length;o+=1)_[o]=re(ae(a,D,o));let H=I(a[1]),m=[];for(let o=0;o<H.length;o+=1)m[o]=ce(se(a,H,o));return{c(){t=b("button"),t.textContent=n,s=R(),e=b("div"),l=b("h3"),c=M(i),w=R(),y=b("button"),y.textContent=P,L=R(),h=b("button"),h.textContent=V,q=R(),T=b("button"),T.innerHTML=x,S=R(),p=b("div"),C=b("table"),z=b("thead"),N=b("tr");for(let o=0;o<_.length;o+=1)_[o].c();F=R(),B=b("tbody");for(let o=0;o<m.length;o+=1)m[o].c();this.h()},l(o){t=v(o,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(t)!=="svelte-gzgy0l"&&(t.textContent=n),s=j(o),e=v(o,"DIV",{class:!0});var f=k(e);l=v(f,"H3",{class:!0});var r=k(l);c=J(r,i),r.forEach(u),w=j(f),y=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(y)!=="svelte-35dso1"&&(y.textContent=P),L=j(f),h=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(h)!=="svelte-rpjn71"&&(h.textContent=V),q=j(f),T=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(T)!=="svelte-gorug2"&&(T.innerHTML=x),S=j(f),p=v(f,"DIV",{class:!0});var O=k(p);C=v(O,"TABLE",{class:!0});var K=k(C);z=v(K,"THEAD",{});var Z=k(z);N=v(Z,"TR",{class:!0});var $=k(N);for(let U=0;U<_.length;U+=1)_[U].l($);$.forEach(u),Z.forEach(u),F=j(K),B=v(K,"TBODY",{});var ee=k(B);for(let U=0;U<m.length;U+=1)m[U].l(ee);ee.forEach(u),K.forEach(u),O.forEach(u),f.forEach(u),this.h()},h(){g(t,"class","reset-button button svelte-14r8um9"),g(l,"class","store-name svelte-14r8um9"),g(y,"class","download-button button svelte-14r8um9"),g(h,"class","download-button button svelte-14r8um9"),g(T,"class","mining-button button svelte-14r8um9"),g(N,"class","svelte-14r8um9"),g(C,"class","review-table svelte-14r8um9"),g(p,"class","review-table-box svelte-14r8um9"),g(e,"class","review-box svelte-14r8um9")},m(o,f){E(o,t,f),E(o,s,f),E(o,e,f),d(e,l),d(l,c),d(e,w),d(e,y),d(e,L),d(e,h),d(e,q),d(e,T),d(e,S),d(e,p),d(p,C),d(C,z),d(z,N);for(let r=0;r<_.length;r+=1)_[r]&&_[r].m(N,null);d(C,F),d(C,B);for(let r=0;r<m.length;r+=1)m[r]&&m[r].m(B,null);G||(X=[Q(t,"click",function(){me(a[3])&&a[3].apply(this,arguments)}),Q(y,"click",a[5]),Q(h,"click",a[6]),Q(T,"click",a[7])],G=!0)},p(o,[f]){if(a=o,f&1&&i!==(i=a[0].Name+"")&&A(c,i),f&2){D=I(Object.keys(a[1][0]));let r;for(r=0;r<D.length;r+=1){const O=ae(a,D,r);_[r]?_[r].p(O,f):(_[r]=re(O),_[r].c(),_[r].m(N,null))}for(;r<_.length;r+=1)_[r].d(1);_.length=D.length}if(f&2){H=I(a[1]);let r;for(r=0;r<H.length;r+=1){const O=se(a,H,r);m[r]?m[r].p(O,f):(m[r]=ce(O),m[r].c(),m[r].m(B,null))}for(;r<m.length;r+=1)m[r].d(1);m.length=H.length}},i:te,o:te,d(o){o&&(u(t),u(s),u(e)),W(_,o),W(m,o),G=!1,de(X)}}}function we(a,t,n){let{selectedStore:s}=t,{reviews:e}=t,{download:l}=t,{handleReset:i}=t;const c=async h=>{const[V,q]=e.map(p=>[p.content,p.rating]);let T="";const x=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:s.Name,reviews:V,ratings:q})});if(x.ok)T=(await x.json()).dataUUID;else{console.error("Error:",x.statusText),alert("無法使用 StoreCoach 探勘");return}const S=document.createElement("a");S.href=`https://storecoach.hazelnut-paradise.com/review-mining/${T}`,h&&(S.target="_blank"),S.click()};let w={};_e(async()=>{const h=new URLSearchParams(window.location.search);w=Object.fromEntries(h.entries()),console.log(w),w.mode&&w.mode==="storecoach"&&await c(!1)});const y=()=>l("csv"),P=()=>l("json"),L=()=>c(!0);return a.$$set=h=>{"selectedStore"in h&&n(0,s=h.selectedStore),"reviews"in h&&n(1,e=h.reviews),"download"in h&&n(2,l=h.download),"handleReset"in h&&n(3,i=h.handleReset)},[s,e,l,i,c,y,P,L]}class pe extends he{constructor(t){super(),ue(this,t,we,ke,fe,{selectedStore:0,reviews:1,download:2,handleReset:3})}}export{pe as default};
