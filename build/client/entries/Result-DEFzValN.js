import{S as fe,i as _e,s as de,d as h,t as X,b as Z,e as me,h as O,k as F,q as ve,o as $,a as be,m as ge,j as ke,f as pe,J as ee,K as we,r as J,u as d,O as Q,v as p,w as b,Q as Y,z as x,x as y,y as P,A as g,C as B,B as V,E as he,U as ye,g as Te}from"../chunks/index-BtOapRR_.js";import{e as I}from"../chunks/each-D6YF6ztN.js";import Ee from"./Redirecting-CznNsw3q.js";import"./Loader-Cd00ZqkO.js";function ae(a,e,s){const n=a.slice();return n[10]=e[s],n}function oe(a,e,s){const n=a.slice();return n[13]=e[s],n}function ie(a,e,s){const n=a.slice();return n[16]=e[s],n}function Ce(a){let e,s="查詢其他商家",n,t,l,c=a[0].Name+"",i,u,f,S="下載 CSV",L,T,k="下載 JSON",M,E,z="使用 <strong>StoreCoach</strong> 探勘",R,C,w,A,U,G,D,W,te,H=I(Object.keys(a[1][0])),m=[];for(let r=0;r<H.length;r+=1)m[r]=ce(ie(a,H,r));let q=I(a[1]),v=[];for(let r=0;r<q.length;r+=1)v[r]=ue(ae(a,q,r));return{c(){e=g("button"),e.textContent=s,n=B(),t=g("div"),l=g("h3"),i=V(c),u=B(),f=g("button"),f.textContent=S,L=B(),T=g("button"),T.textContent=k,M=B(),E=g("button"),E.innerHTML=z,R=B(),C=g("div"),w=g("table"),A=g("thead"),U=g("tr");for(let r=0;r<m.length;r+=1)m[r].c();G=B(),D=g("tbody");for(let r=0;r<v.length;r+=1)v[r].c();this.h()},l(r){e=b(r,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-1z0u94t"&&(e.textContent=s),n=x(r),t=b(r,"DIV",{class:!0});var _=y(t);l=b(_,"H3",{class:!0});var o=y(l);i=P(o,c),o.forEach(h),u=x(_),f=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(f)!=="svelte-15p6db5"&&(f.textContent=S),L=x(_),T=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(T)!=="svelte-osw2el"&&(T.textContent=k),M=x(_),E=b(_,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(E)!=="svelte-1a53k2q"&&(E.innerHTML=z),R=x(_),C=b(_,"DIV",{class:!0});var N=y(C);w=b(N,"TABLE",{class:!0});var K=y(w);A=b(K,"THEAD",{});var le=y(A);U=b(le,"TR",{class:!0});var ne=y(U);for(let j=0;j<m.length;j+=1)m[j].l(ne);ne.forEach(h),le.forEach(h),G=x(K),D=b(K,"TBODY",{});var se=y(D);for(let j=0;j<v.length;j+=1)v[j].l(se);se.forEach(h),K.forEach(h),N.forEach(h),_.forEach(h),this.h()},h(){p(e,"class","reset-button button svelte-1d9uiic"),p(l,"class","store-name svelte-1d9uiic"),p(f,"class","download-button button svelte-1d9uiic"),p(T,"class","download-button button svelte-1d9uiic"),p(E,"class","mining-button button svelte-1d9uiic"),p(U,"class","svelte-1d9uiic"),p(w,"class","review-table svelte-1d9uiic"),p(C,"class","review-table-box svelte-1d9uiic"),p(t,"class","review-box svelte-1d9uiic")},m(r,_){O(r,e,_),O(r,n,_),O(r,t,_),d(t,l),d(l,i),d(t,u),d(t,f),d(t,L),d(t,T),d(t,M),d(t,E),d(t,R),d(t,C),d(C,w),d(w,A),d(A,U);for(let o=0;o<m.length;o+=1)m[o]&&m[o].m(U,null);d(w,G),d(w,D);for(let o=0;o<v.length;o+=1)v[o]&&v[o].m(D,null);W||(te=[Q(e,"click",function(){ye(a[3])&&a[3].apply(this,arguments)}),Q(f,"click",a[6]),Q(T,"click",a[7]),Q(E,"click",a[8])],W=!0)},p(r,_){if(a=r,_&1&&c!==(c=a[0].Name+"")&&J(i,c),_&2){H=I(Object.keys(a[1][0]));let o;for(o=0;o<H.length;o+=1){const N=ie(a,H,o);m[o]?m[o].p(N,_):(m[o]=ce(N),m[o].c(),m[o].m(U,null))}for(;o<m.length;o+=1)m[o].d(1);m.length=H.length}if(_&2){q=I(a[1]);let o;for(o=0;o<q.length;o+=1){const N=ae(a,q,o);v[o]?v[o].p(N,_):(v[o]=ue(N),v[o].c(),v[o].m(D,null))}for(;o<v.length;o+=1)v[o].d(1);v.length=q.length}},i:$,o:$,d(r){r&&(h(e),h(n),h(t)),ee(m,r),ee(v,r),W=!1,we(te)}}}function Oe(a){let e,s;return e=new Ee({}),{c(){pe(e.$$.fragment)},l(n){ke(e.$$.fragment,n)},m(n,t){ge(e,n,t),s=!0},p:$,i(n){s||(Z(e.$$.fragment,n),s=!0)},o(n){X(e.$$.fragment,n),s=!1},d(n){be(e,n)}}}function Se(a){let e,s=a[16]+"",n;return{c(){e=g("th"),n=V(s),this.h()},l(t){e=b(t,"TH",{class:!0});var l=y(e);n=P(l,s),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&J(n,s)},d(t){t&&h(e)}}}function Ne(a){let e,s=a[16]+"",n;return{c(){e=g("th"),n=V(s),this.h()},l(t){e=b(t,"TH",{style:!0,class:!0});var l=y(e);n=P(l,s),l.forEach(h),this.h()},h(){he(e,"min-width","400px"),p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&J(n,s)},d(t){t&&h(e)}}}function Re(a){let e,s=a[16]+"",n;return{c(){e=g("th"),n=V(s),this.h()},l(t){e=b(t,"TH",{style:!0,class:!0});var l=y(e);n=P(l,s),l.forEach(h),this.h()},h(){he(e,"min-width","500px"),p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[16]+"")&&J(n,s)},d(t){t&&h(e)}}}function ce(a){let e;function s(l,c){return l[16]==="content"?Re:l[16]==="reviewer_id"?Ne:Se}let n=s(a),t=n(a);return{c(){t.c(),e=F()},l(l){t.l(l),e=F()},m(l,c){t.m(l,c),O(l,e,c)},p(l,c){n===(n=s(l))&&t?t.p(l,c):(t.d(1),t=n(l),t&&(t.c(),t.m(e.parentNode,e)))},d(l){l&&h(e),t.d(l)}}}function re(a){let e,s=a[13]+"",n;return{c(){e=g("td"),n=V(s),this.h()},l(t){e=b(t,"TD",{class:!0});var l=y(e);n=P(l,s),l.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(t,l){O(t,e,l),d(e,n)},p(t,l){l&2&&s!==(s=t[13]+"")&&J(n,s)},d(t){t&&h(e)}}}function ue(a){let e,s,n=I(Object.values(a[10])),t=[];for(let l=0;l<n.length;l+=1)t[l]=re(oe(a,n,l));return{c(){e=g("tr");for(let l=0;l<t.length;l+=1)t[l].c();s=B(),this.h()},l(l){e=b(l,"TR",{class:!0});var c=y(e);for(let i=0;i<t.length;i+=1)t[i].l(c);s=x(c),c.forEach(h),this.h()},h(){p(e,"class","svelte-1d9uiic")},m(l,c){O(l,e,c);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null);d(e,s)},p(l,c){if(c&2){n=I(Object.values(l[10]));let i;for(i=0;i<n.length;i+=1){const u=oe(l,n,i);t[i]?t[i].p(u,c):(t[i]=re(u),t[i].c(),t[i].m(e,s))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(l){l&&h(e),ee(t,l)}}}function Ue(a){let e,s,n,t;const l=[Oe,Ce],c=[];function i(u,f){return u[4]?0:1}return e=i(a),s=c[e]=l[e](a),{c(){s.c(),n=F()},l(u){s.l(u),n=F()},m(u,f){c[e].m(u,f),O(u,n,f),t=!0},p(u,[f]){let S=e;e=i(u),e===S?c[e].p(u,f):(Te(),X(c[S],1,1,()=>{c[S]=null}),me(),s=c[e],s?s.p(u,f):(s=c[e]=l[e](u),s.c()),Z(s,1),s.m(n.parentNode,n))},i(u){t||(Z(s),t=!0)},o(u){X(s),t=!1},d(u){u&&h(n),c[e].d(u)}}}function je(a,e,s){let{selectedStore:n}=e,{reviews:t}=e,{download:l}=e,{handleReset:c}=e,i=!1;const u=async k=>{s(4,i=!0);const[M,E]=t.map(w=>[w.content,w.rating]);let z="";const R=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:n.Name,reviews:M,ratings:E})});if(R.ok)z=(await R.json()).dataUUID;else{console.error("Error:",R.statusText),alert("無法使用 StoreCoach 探勘");return}const C=document.createElement("a");C.href=`https://storecoach.hazelnut-paradise.com/review-mining/${z}`,k&&(C.target="_blank"),C.click(),s(4,i=!1)};let f={};ve(async()=>{const k=new URLSearchParams(window.location.search);f=Object.fromEntries(k.entries()),console.log(f),f.mode&&f.mode==="storecoach"&&await u(!1)});const S=()=>l("csv"),L=()=>l("json"),T=()=>u(!0);return a.$$set=k=>{"selectedStore"in k&&s(0,n=k.selectedStore),"reviews"in k&&s(1,t=k.reviews),"download"in k&&s(2,l=k.download),"handleReset"in k&&s(3,c=k.handleReset)},[n,t,l,c,i,u,S,L,T]}class qe extends fe{constructor(e){super(),_e(this,e,je,Ue,de,{selectedStore:0,reviews:1,download:2,handleReset:3})}}export{qe as default};
