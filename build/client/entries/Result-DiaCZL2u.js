import{S as he,i as ue,s as fe,o as te,d as h,O as W,P as _e,r as A,h as O,u as _,U as F,v as g,w as v,I as G,z as I,x as w,y as M,A as b,C as x,B as V,q as de,k as le,H as ie,Y as me}from"../chunks/index-BcAQgaGx.js";import{e as L}from"../chunks/each-D6YF6ztN.js";function se(a,t,n){const s=a.slice();return s[11]=t[n],s}function ne(a,t,n){const s=a.slice();return s[14]=t[n],s}function ae(a,t,n){const s=a.slice();return s[17]=t[n],s}function ve(a){let t,n=a[17]+"",s;return{c(){t=b("th"),s=V(n),this.h()},l(e){t=v(e,"TH",{class:!0});var l=w(t);s=M(l,n),l.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){O(e,t,l),_(t,s)},p(e,l){l&2&&n!==(n=e[17]+"")&&A(s,n)},d(e){e&&h(t)}}}function be(a){let t,n=a[17]+"",s;return{c(){t=b("th"),s=V(n),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=w(t);s=M(l,n),l.forEach(h),this.h()},h(){ie(t,"min-width","400px"),g(t,"class","svelte-14r8um9")},m(e,l){O(e,t,l),_(t,s)},p(e,l){l&2&&n!==(n=e[17]+"")&&A(s,n)},d(e){e&&h(t)}}}function ge(a){let t,n=a[17]+"",s;return{c(){t=b("th"),s=V(n),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=w(t);s=M(l,n),l.forEach(h),this.h()},h(){ie(t,"min-width","500px"),g(t,"class","svelte-14r8um9")},m(e,l){O(e,t,l),_(t,s)},p(e,l){l&2&&n!==(n=e[17]+"")&&A(s,n)},d(e){e&&h(t)}}}function re(a){let t;function n(l,i){return l[17]==="content"?ge:l[17]==="reviewer_id"?be:ve}let s=n(a),e=s(a);return{c(){e.c(),t=le()},l(l){e.l(l),t=le()},m(l,i){e.m(l,i),O(l,t,i)},p(l,i){s===(s=n(l))&&e?e.p(l,i):(e.d(1),e=s(l),e&&(e.c(),e.m(t.parentNode,t)))},d(l){l&&h(t),e.d(l)}}}function oe(a){let t,n=a[14]+"",s;return{c(){t=b("td"),s=V(n),this.h()},l(e){t=v(e,"TD",{class:!0});var l=w(t);s=M(l,n),l.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){O(e,t,l),_(t,s)},p(e,l){l&2&&n!==(n=e[14]+"")&&A(s,n)},d(e){e&&h(t)}}}function ce(a){let t,n,s=L(Object.values(a[11])),e=[];for(let l=0;l<s.length;l+=1)e[l]=oe(ne(a,s,l));return{c(){t=b("tr");for(let l=0;l<e.length;l+=1)e[l].c();n=x(),this.h()},l(l){t=v(l,"TR",{class:!0});var i=w(t);for(let o=0;o<e.length;o+=1)e[o].l(i);n=I(i),i.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(l,i){O(l,t,i);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(t,null);_(t,n)},p(l,i){if(i&2){s=L(Object.values(l[11]));let o;for(o=0;o<s.length;o+=1){const S=ne(l,s,o);e[o]?e[o].p(S,i):(e[o]=oe(S),e[o].c(),e[o].m(t,n))}for(;o<e.length;o+=1)e[o].d(1);e.length=s.length}},d(l){l&&h(t),W(e,l)}}}function ke(a){let t,n="查詢其他商家",s,e,l,i=a[0].Name+"",o,S,k,D="下載 CSV",P,y,J="下載 JSON",u,C,q="使用 <strong>StoreCoach</strong> 探勘",N,E,T,z,U,K,H,Q,X,R=L(Object.keys(a[1][0])),d=[];for(let c=0;c<R.length;c+=1)d[c]=re(ae(a,R,c));let B=L(a[1]),m=[];for(let c=0;c<B.length;c+=1)m[c]=ce(se(a,B,c));return{c(){t=b("button"),t.textContent=n,s=x(),e=b("div"),l=b("h3"),o=V(i),S=x(),k=b("button"),k.textContent=D,P=x(),y=b("button"),y.textContent=J,u=x(),C=b("button"),C.innerHTML=q,N=x(),E=b("div"),T=b("table"),z=b("thead"),U=b("tr");for(let c=0;c<d.length;c+=1)d[c].c();K=x(),H=b("tbody");for(let c=0;c<m.length;c+=1)m[c].c();this.h()},l(c){t=v(c,"BUTTON",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-gzgy0l"&&(t.textContent=n),s=I(c),e=v(c,"DIV",{class:!0});var f=w(e);l=v(f,"H3",{class:!0});var r=w(l);o=M(r,i),r.forEach(h),S=I(f),k=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),G(k)!=="svelte-35dso1"&&(k.textContent=D),P=I(f),y=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),G(y)!=="svelte-rpjn71"&&(y.textContent=J),u=I(f),C=v(f,"BUTTON",{class:!0,"data-svelte-h":!0}),G(C)!=="svelte-gorug2"&&(C.innerHTML=q),N=I(f),E=v(f,"DIV",{class:!0});var p=w(E);T=v(p,"TABLE",{class:!0});var Y=w(T);z=v(Y,"THEAD",{});var Z=w(z);U=v(Z,"TR",{class:!0});var $=w(U);for(let j=0;j<d.length;j+=1)d[j].l($);$.forEach(h),Z.forEach(h),K=I(Y),H=v(Y,"TBODY",{});var ee=w(H);for(let j=0;j<m.length;j+=1)m[j].l(ee);ee.forEach(h),Y.forEach(h),p.forEach(h),f.forEach(h),this.h()},h(){g(t,"class","reset-button button svelte-14r8um9"),g(l,"class","store-name svelte-14r8um9"),g(k,"class","download-button button svelte-14r8um9"),g(y,"class","download-button button svelte-14r8um9"),g(C,"class","mining-button button svelte-14r8um9"),g(U,"class","svelte-14r8um9"),g(T,"class","review-table svelte-14r8um9"),g(E,"class","review-table-box svelte-14r8um9"),g(e,"class","review-box svelte-14r8um9")},m(c,f){O(c,t,f),O(c,s,f),O(c,e,f),_(e,l),_(l,o),_(e,S),_(e,k),_(e,P),_(e,y),_(e,u),_(e,C),_(e,N),_(e,E),_(E,T),_(T,z),_(z,U);for(let r=0;r<d.length;r+=1)d[r]&&d[r].m(U,null);_(T,K),_(T,H);for(let r=0;r<m.length;r+=1)m[r]&&m[r].m(H,null);Q||(X=[F(t,"click",function(){me(a[3])&&a[3].apply(this,arguments)}),F(k,"click",a[7]),F(y,"click",a[8]),F(C,"click",a[9])],Q=!0)},p(c,[f]){if(a=c,f&1&&i!==(i=a[0].Name+"")&&A(o,i),f&2){R=L(Object.keys(a[1][0]));let r;for(r=0;r<R.length;r+=1){const p=ae(a,R,r);d[r]?d[r].p(p,f):(d[r]=re(p),d[r].c(),d[r].m(U,null))}for(;r<d.length;r+=1)d[r].d(1);d.length=R.length}if(f&2){B=L(a[1]);let r;for(r=0;r<B.length;r+=1){const p=se(a,B,r);m[r]?m[r].p(p,f):(m[r]=ce(p),m[r].c(),m[r].m(H,null))}for(;r<m.length;r+=1)m[r].d(1);m.length=B.length}},i:te,o:te,d(c){c&&(h(t),h(s),h(e)),W(d,c),W(m,c),Q=!1,_e(X)}}}function we(a,t,n){let{selectedStore:s}=t,{searchInputStr:e}=t,{storeData:l}=t,{reviews:i}=t,{download:o}=t,{handleReset:S}=t;const k=async u=>{const C=i.map(T=>T.content);let q="";const N=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:s.Name,reviews:C})});if(N.ok)q=(await N.json()).dataUUID;else{console.error("Error:",N.statusText),alert("無法使用 StoreCoach 探勘");return}const E=document.createElement("a");E.href=`https://storecoach.hazelnut-paradise.com/review-mining/${q}`,u&&(E.target="_blank"),E.click()};let D={};de(async()=>{const u=new URLSearchParams(window.location.search);D=Object.fromEntries(u.entries()),console.log(D),D.mode&&D.mode==="storecoach"&&await k(!1)});const P=()=>o("csv"),y=()=>o("json"),J=()=>k(!0);return a.$$set=u=>{"selectedStore"in u&&n(0,s=u.selectedStore),"searchInputStr"in u&&n(5,e=u.searchInputStr),"storeData"in u&&n(6,l=u.storeData),"reviews"in u&&n(1,i=u.reviews),"download"in u&&n(2,o=u.download),"handleReset"in u&&n(3,S=u.handleReset)},[s,i,o,S,k,e,l,P,y,J]}class Ce extends he{constructor(t){super(),ue(this,t,we,ke,fe,{selectedStore:0,searchInputStr:5,storeData:6,reviews:1,download:2,handleReset:3})}}export{Ce as default};
