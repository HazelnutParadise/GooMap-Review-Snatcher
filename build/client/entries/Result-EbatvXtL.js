import{S as ct,i as it,s as ht,o as et,d as m,O as G,P as ut,r as K,h as L,u as f,U as z,v as w,w as v,I as J,z as N,x as O,y as Q,A as b,C as U,B as W,q as ft}from"../chunks/index-BcAQgaGx.js";import{e as H}from"../chunks/each-D6YF6ztN.js";function lt(c,e,a){const o=c.slice();return o[11]=e[a],o}function st(c,e,a){const o=c.slice();return o[14]=e[a],o}function nt(c,e,a){const o=c.slice();return o[17]=e[a],o}function at(c){let e,a=c[17]+"",o;return{c(){e=b("th"),o=W(a),this.h()},l(t){e=v(t,"TH",{class:!0});var l=O(e);o=Q(l,a),l.forEach(m),this.h()},h(){w(e,"class","svelte-14r8um9")},m(t,l){L(t,e,l),f(e,o)},p(t,l){l&4&&a!==(a=t[17]+"")&&K(o,a)},d(t){t&&m(e)}}}function ot(c){let e,a=c[14]+"",o;return{c(){e=b("td"),o=W(a),this.h()},l(t){e=v(t,"TD",{class:!0});var l=O(e);o=Q(l,a),l.forEach(m),this.h()},h(){w(e,"class","svelte-14r8um9")},m(t,l){L(t,e,l),f(e,o)},p(t,l){l&4&&a!==(a=t[14]+"")&&K(o,a)},d(t){t&&m(e)}}}function rt(c){let e,a,o=H(Object.values(c[11])),t=[];for(let l=0;l<o.length;l+=1)t[l]=ot(st(c,o,l));return{c(){e=b("tr");for(let l=0;l<t.length;l+=1)t[l].c();a=U(),this.h()},l(l){e=v(l,"TR",{class:!0});var h=O(e);for(let r=0;r<t.length;r+=1)t[r].l(h);a=N(h),h.forEach(m),this.h()},h(){w(e,"class","svelte-14r8um9")},m(l,h){L(l,e,h);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null);f(e,a)},p(l,h){if(h&4){o=H(Object.values(l[11]));let r;for(r=0;r<o.length;r+=1){const T=st(l,o,r);t[r]?t[r].p(T,h):(t[r]=ot(T),t[r].c(),t[r].m(e,a))}for(;r<t.length;r+=1)t[r].d(1);t.length=o.length}},d(l){l&&m(e),G(t,l)}}}function dt(c){let e,a="查詢其他商家",o,t,l,h=c[3].Name+"",r,T,g,A="下載 CSV",P,C,M="下載 JSON",u,S,R="使用 <strong>StoreCoach</strong> 探勘",y,E,k,q,D,Y,I,F,X,B=H(Object.keys(c[2][0])),d=[];for(let n=0;n<B.length;n+=1)d[n]=at(nt(c,B,n));let p=H(c[2]),_=[];for(let n=0;n<p.length;n+=1)_[n]=rt(lt(c,p,n));return{c(){e=b("button"),e.textContent=a,o=U(),t=b("div"),l=b("h3"),r=W(h),T=U(),g=b("button"),g.textContent=A,P=U(),C=b("button"),C.textContent=M,u=U(),S=b("button"),S.innerHTML=R,y=U(),E=b("div"),k=b("table"),q=b("thead"),D=b("tr");for(let n=0;n<d.length;n+=1)d[n].c();Y=U(),I=b("tbody");for(let n=0;n<_.length;n+=1)_[n].c();this.h()},l(n){e=v(n,"BUTTON",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-l0jswp"&&(e.textContent=a),o=N(n),t=v(n,"DIV",{class:!0});var i=O(t);l=v(i,"H3",{class:!0});var s=O(l);r=Q(s,h),s.forEach(m),T=N(i),g=v(i,"BUTTON",{class:!0,"data-svelte-h":!0}),J(g)!=="svelte-35dso1"&&(g.textContent=A),P=N(i),C=v(i,"BUTTON",{class:!0,"data-svelte-h":!0}),J(C)!=="svelte-rpjn71"&&(C.textContent=M),u=N(i),S=v(i,"BUTTON",{class:!0,"data-svelte-h":!0}),J(S)!=="svelte-gorug2"&&(S.innerHTML=R),y=N(i),E=v(i,"DIV",{class:!0});var x=O(E);k=v(x,"TABLE",{class:!0});var V=O(k);q=v(V,"THEAD",{});var Z=O(q);D=v(Z,"TR",{class:!0});var $=O(D);for(let j=0;j<d.length;j+=1)d[j].l($);$.forEach(m),Z.forEach(m),Y=N(V),I=v(V,"TBODY",{});var tt=O(I);for(let j=0;j<_.length;j+=1)_[j].l(tt);tt.forEach(m),V.forEach(m),x.forEach(m),i.forEach(m),this.h()},h(){w(e,"class","reset-button button svelte-14r8um9"),w(l,"class","store-name svelte-14r8um9"),w(g,"class","download-button button svelte-14r8um9"),w(C,"class","download-button button svelte-14r8um9"),w(S,"class","mining-button button svelte-14r8um9"),w(D,"class","svelte-14r8um9"),w(k,"class","review-table svelte-14r8um9"),w(E,"class","review-table-box svelte-14r8um9"),w(t,"class","review-box svelte-14r8um9")},m(n,i){L(n,e,i),L(n,o,i),L(n,t,i),f(t,l),f(l,r),f(t,T),f(t,g),f(t,P),f(t,C),f(t,u),f(t,S),f(t,y),f(t,E),f(E,k),f(k,q),f(q,D);for(let s=0;s<d.length;s+=1)d[s]&&d[s].m(D,null);f(k,Y),f(k,I);for(let s=0;s<_.length;s+=1)_[s]&&_[s].m(I,null);F||(X=[z(e,"click",c[6]),z(g,"click",c[7]),z(C,"click",c[8]),z(S,"click",c[9])],F=!0)},p(n,[i]){if(i&8&&h!==(h=n[3].Name+"")&&K(r,h),i&4){B=H(Object.keys(n[2][0]));let s;for(s=0;s<B.length;s+=1){const x=nt(n,B,s);d[s]?d[s].p(x,i):(d[s]=at(x),d[s].c(),d[s].m(D,null))}for(;s<d.length;s+=1)d[s].d(1);d.length=B.length}if(i&4){p=H(n[2]);let s;for(s=0;s<p.length;s+=1){const x=lt(n,p,s);_[s]?_[s].p(x,i):(_[s]=rt(x),_[s].c(),_[s].m(I,null))}for(;s<_.length;s+=1)_[s].d(1);_.length=p.length}},i:et,o:et,d(n){n&&(m(e),m(o),m(t)),G(d,n),G(_,n),F=!1,ut(X)}}}function _t(c,e,a){let{selectedStore:o}=e,{searchInputStr:t}=e,{storeData:l}=e,{reviews:h}=e,{download:r}=e;const T=async u=>{const S=h.map(k=>k.content);let R="";const y=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:o.Name,reviews:S})});if(y.ok)R=(await y.json()).dataUUID;else{console.error("Error:",y.statusText),alert("無法使用 StoreCoach 探勘");return}const E=document.createElement("a");E.href=`https://storecoach.hazelnut-paradise.com/review-mining/${R}`,u&&(E.target="_blank"),E.click()};let g={};ft(async()=>{const u=new URLSearchParams(window.location.search);g=Object.fromEntries(u.entries()),console.log(g),g.mode&&g.mode==="storecoach"&&await T(!1)});const A=()=>{a(0,t=""),a(1,l=[]),a(2,h=[])},P=()=>r("csv"),C=()=>r("json"),M=()=>T(!0);return c.$$set=u=>{"selectedStore"in u&&a(3,o=u.selectedStore),"searchInputStr"in u&&a(0,t=u.searchInputStr),"storeData"in u&&a(1,l=u.storeData),"reviews"in u&&a(2,h=u.reviews),"download"in u&&a(4,r=u.download)},[t,l,h,o,r,T,A,P,C,M]}class bt extends ct{constructor(e){super(),it(this,e,_t,dt,ht,{selectedStore:3,searchInputStr:0,storeData:1,reviews:2,download:4})}}export{bt as default};
