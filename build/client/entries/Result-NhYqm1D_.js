import{S as he,i as ue,s as fe,o as te,d as h,O as W,P as _e,r as A,h as p,u as f,U as F,v as g,w as v,I as G,z as j,x as w,y as M,A as b,C as U,B as V,q as de,k as le,H as ie}from"../chunks/index-BcAQgaGx.js";import{e as L}from"../chunks/each-D6YF6ztN.js";function se(o,t,s){const n=o.slice();return n[11]=t[s],n}function ne(o,t,s){const n=o.slice();return n[14]=t[s],n}function ae(o,t,s){const n=o.slice();return n[17]=t[s],n}function me(o){let t,s=o[17]+"",n;return{c(){t=b("th"),n=V(s),this.h()},l(e){t=v(e,"TH",{class:!0});var l=w(t);n=M(l,s),l.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){p(e,t,l),f(t,n)},p(e,l){l&4&&s!==(s=e[17]+"")&&A(n,s)},d(e){e&&h(t)}}}function ve(o){let t,s=o[17]+"",n;return{c(){t=b("th"),n=V(s),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=w(t);n=M(l,s),l.forEach(h),this.h()},h(){ie(t,"min-width","400px"),g(t,"class","svelte-14r8um9")},m(e,l){p(e,t,l),f(t,n)},p(e,l){l&4&&s!==(s=e[17]+"")&&A(n,s)},d(e){e&&h(t)}}}function be(o){let t,s=o[17]+"",n;return{c(){t=b("th"),n=V(s),this.h()},l(e){t=v(e,"TH",{style:!0,class:!0});var l=w(t);n=M(l,s),l.forEach(h),this.h()},h(){ie(t,"min-width","500px"),g(t,"class","svelte-14r8um9")},m(e,l){p(e,t,l),f(t,n)},p(e,l){l&4&&s!==(s=e[17]+"")&&A(n,s)},d(e){e&&h(t)}}}function re(o){let t;function s(l,i){return l[17]==="content"?be:l[17]==="reviewer_id"?ve:me}let n=s(o),e=n(o);return{c(){e.c(),t=le()},l(l){e.l(l),t=le()},m(l,i){e.m(l,i),p(l,t,i)},p(l,i){n===(n=s(l))&&e?e.p(l,i):(e.d(1),e=n(l),e&&(e.c(),e.m(t.parentNode,t)))},d(l){l&&h(t),e.d(l)}}}function oe(o){let t,s=o[14]+"",n;return{c(){t=b("td"),n=V(s),this.h()},l(e){t=v(e,"TD",{class:!0});var l=w(t);n=M(l,s),l.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(e,l){p(e,t,l),f(t,n)},p(e,l){l&4&&s!==(s=e[14]+"")&&A(n,s)},d(e){e&&h(t)}}}function ce(o){let t,s,n=L(Object.values(o[11])),e=[];for(let l=0;l<n.length;l+=1)e[l]=oe(ne(o,n,l));return{c(){t=b("tr");for(let l=0;l<e.length;l+=1)e[l].c();s=U(),this.h()},l(l){t=v(l,"TR",{class:!0});var i=w(t);for(let c=0;c<e.length;c+=1)e[c].l(i);s=j(i),i.forEach(h),this.h()},h(){g(t,"class","svelte-14r8um9")},m(l,i){p(l,t,i);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);f(t,s)},p(l,i){if(i&4){n=L(Object.values(l[11]));let c;for(c=0;c<n.length;c+=1){const y=ne(l,n,c);e[c]?e[c].p(y,i):(e[c]=oe(y),e[c].c(),e[c].m(t,s))}for(;c<e.length;c+=1)e[c].d(1);e.length=n.length}},d(l){l&&h(t),W(e,l)}}}function ge(o){let t,s="查詢其他商家",n,e,l,i=o[3].Name+"",c,y,k,z="下載 CSV",P,C,J="下載 JSON",_,E,R="使用 <strong>StoreCoach</strong> 探勘",x,S,T,q,D,K,I,Q,X,H=L(Object.keys(o[2][0])),d=[];for(let r=0;r<H.length;r+=1)d[r]=re(ae(o,H,r));let B=L(o[2]),m=[];for(let r=0;r<B.length;r+=1)m[r]=ce(se(o,B,r));return{c(){t=b("button"),t.textContent=s,n=U(),e=b("div"),l=b("h3"),c=V(i),y=U(),k=b("button"),k.textContent=z,P=U(),C=b("button"),C.textContent=J,_=U(),E=b("button"),E.innerHTML=R,x=U(),S=b("div"),T=b("table"),q=b("thead"),D=b("tr");for(let r=0;r<d.length;r+=1)d[r].c();K=U(),I=b("tbody");for(let r=0;r<m.length;r+=1)m[r].c();this.h()},l(r){t=v(r,"BUTTON",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-l0jswp"&&(t.textContent=s),n=j(r),e=v(r,"DIV",{class:!0});var u=w(e);l=v(u,"H3",{class:!0});var a=w(l);c=M(a,i),a.forEach(h),y=j(u),k=v(u,"BUTTON",{class:!0,"data-svelte-h":!0}),G(k)!=="svelte-35dso1"&&(k.textContent=z),P=j(u),C=v(u,"BUTTON",{class:!0,"data-svelte-h":!0}),G(C)!=="svelte-rpjn71"&&(C.textContent=J),_=j(u),E=v(u,"BUTTON",{class:!0,"data-svelte-h":!0}),G(E)!=="svelte-gorug2"&&(E.innerHTML=R),x=j(u),S=v(u,"DIV",{class:!0});var O=w(S);T=v(O,"TABLE",{class:!0});var Y=w(T);q=v(Y,"THEAD",{});var Z=w(q);D=v(Z,"TR",{class:!0});var $=w(D);for(let N=0;N<d.length;N+=1)d[N].l($);$.forEach(h),Z.forEach(h),K=j(Y),I=v(Y,"TBODY",{});var ee=w(I);for(let N=0;N<m.length;N+=1)m[N].l(ee);ee.forEach(h),Y.forEach(h),O.forEach(h),u.forEach(h),this.h()},h(){g(t,"class","reset-button button svelte-14r8um9"),g(l,"class","store-name svelte-14r8um9"),g(k,"class","download-button button svelte-14r8um9"),g(C,"class","download-button button svelte-14r8um9"),g(E,"class","mining-button button svelte-14r8um9"),g(D,"class","svelte-14r8um9"),g(T,"class","review-table svelte-14r8um9"),g(S,"class","review-table-box svelte-14r8um9"),g(e,"class","review-box svelte-14r8um9")},m(r,u){p(r,t,u),p(r,n,u),p(r,e,u),f(e,l),f(l,c),f(e,y),f(e,k),f(e,P),f(e,C),f(e,_),f(e,E),f(e,x),f(e,S),f(S,T),f(T,q),f(q,D);for(let a=0;a<d.length;a+=1)d[a]&&d[a].m(D,null);f(T,K),f(T,I);for(let a=0;a<m.length;a+=1)m[a]&&m[a].m(I,null);Q||(X=[F(t,"click",o[6]),F(k,"click",o[7]),F(C,"click",o[8]),F(E,"click",o[9])],Q=!0)},p(r,[u]){if(u&8&&i!==(i=r[3].Name+"")&&A(c,i),u&4){H=L(Object.keys(r[2][0]));let a;for(a=0;a<H.length;a+=1){const O=ae(r,H,a);d[a]?d[a].p(O,u):(d[a]=re(O),d[a].c(),d[a].m(D,null))}for(;a<d.length;a+=1)d[a].d(1);d.length=H.length}if(u&4){B=L(r[2]);let a;for(a=0;a<B.length;a+=1){const O=se(r,B,a);m[a]?m[a].p(O,u):(m[a]=ce(O),m[a].c(),m[a].m(I,null))}for(;a<m.length;a+=1)m[a].d(1);m.length=B.length}},i:te,o:te,d(r){r&&(h(t),h(n),h(e)),W(d,r),W(m,r),Q=!1,_e(X)}}}function ke(o,t,s){let{selectedStore:n}=t,{searchInputStr:e}=t,{storeData:l}=t,{reviews:i}=t,{download:c}=t;const y=async _=>{const E=i.map(T=>T.content);let R="";const x=await fetch("/api/review-mining",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeName:n.Name,reviews:E})});if(x.ok)R=(await x.json()).dataUUID;else{console.error("Error:",x.statusText),alert("無法使用 StoreCoach 探勘");return}const S=document.createElement("a");S.href=`https://storecoach.hazelnut-paradise.com/review-mining/${R}`,_&&(S.target="_blank"),S.click()};let k={};de(async()=>{const _=new URLSearchParams(window.location.search);k=Object.fromEntries(_.entries()),console.log(k),k.mode&&k.mode==="storecoach"&&await y(!1)});const z=()=>{s(0,e=""),s(1,l=[]),s(2,i=[])},P=()=>c("csv"),C=()=>c("json"),J=()=>y(!0);return o.$$set=_=>{"selectedStore"in _&&s(3,n=_.selectedStore),"searchInputStr"in _&&s(0,e=_.searchInputStr),"storeData"in _&&s(1,l=_.storeData),"reviews"in _&&s(2,i=_.reviews),"download"in _&&s(4,c=_.download)},[e,l,i,n,c,y,z,P,C,J]}class ye extends he{constructor(t){super(),ue(this,t,ke,ge,fe,{selectedStore:3,searchInputStr:0,storeData:1,reviews:2,download:4})}}export{ye as default};
