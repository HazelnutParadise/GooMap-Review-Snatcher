import{i as C,n as D,s as M,b as k,p as x,a as N,U as j,E as G,c as u,f as m,d as h,e as W,g as Z}from"../chunks/template-Ck2fRipi.js";import{i as R,a as z}from"../chunks/lifecycle-BJN0pLMS.js";import{p as w,s as S,a as B,b as L,w as y,g as E}from"../chunks/props-8vpwuoM1.js";import{o as H}from"../chunks/index-client-07cMjNGe.js";function U(r,t,n){var o=r,e=j,a,c=C()?D:M;k(()=>{c(e,e=t())&&(a&&x(a),a=N(()=>n(o)))})}function J(r,t,n){var o=r,e,a;k(()=>{e!==(e=t())&&(a&&(x(a),a=null),e&&(a=N(()=>n(o,e))))},G)}function K(r,t){const[n,o]=S(),e=()=>L(c,"$next",n);let a=w(t,"node",8);w(t,"index",8);const{next:c,content:s}=a();var p=u(),d=m(p);J(d,()=>s.comp,(f,_)=>{_(f,B(()=>s.props,{children:(g,P)=>{var l=u(),F=m(l);U(F,e,I=>{var $=u(),T=m($);{var q=v=>{A(v)};R(T,v=>{e()&&v(q)})}h(I,$)}),h(g,l)},$$slots:{default:!0}}))}),h(r,p),o()}function O(r){const t=r.props.node.content.ssrError;return t?new r.props.node.content.errPage({...r,props:t}):new K(r)}const A=O;function b(r){let t=y(null);for(let n=r.length-1;n>=0;n--)t=y({content:r[n],next:t});return t}let i;function Q(r,t){i={},i.url=y(new URL(r)),i.node=b(t),i.hrefMap={[r]:new Promise(n=>n(t))},i.update=async n=>{i.url.set(new URL(n));const o=await(i.hrefMap[n]??V(n));let e=i.node,a=b(o);for(;;){const c=E(e),s=E(a);if(!c&&!s)break;const p=c==null?void 0:c.content.comp,d=s==null?void 0:s.content.comp;if(p===d)e=c.next,a=s.next;else{e.set(s);break}}}}async function V(r){const o=await(await fetch(r,{headers:{Golte:"true"}})).json();for(const a of[...o.Entries,o.ErrPage])for(const c of a.CSS){if(document.querySelector(`link[href="${c}"][rel="stylesheet"]`))continue;const s=document.createElement("link");s.href=c,s.rel="stylesheet",document.head.appendChild(s)}const e=o.Entries.map(async a=>({comp:(await import(a.File)).default,props:a.Props,errPage:(await import(o.ErrPage.File)).default}));return await Promise.all(e)}function X(r,t){W(t,!1);const[n,o]=S(),e=()=>L(s,"$node",n);let a=w(t,"nodes",8),c=w(t,"contextData",8);Q(c().URL,a());const{node:s}=i;H(()=>{history.replaceState(E(i.url).href,""),addEventListener("popstate",async f=>{f.state&&await i.update(f.state)})}),z();var p=u(),d=m(p);U(d,e,f=>{var _=u(),g=m(_);{var P=l=>{A(l)};R(g,l=>{e()&&l(P)})}h(f,_)}),h(r,p),Z(),o()}async function ne(r,t,n){const o=Promise.all(t.map(async e=>({comp:(await import(e.comp)).default,props:e.props,errPage:(await import(e.errPage)).default,ssrError:e.ssrError})));new X({target:r,props:{nodes:await o,contextData:n},hydrate:!0})}export{ne as hydrate};
